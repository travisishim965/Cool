<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>99 NIGHTS: FINAL ARCHITECTURE V100</title>
    <style>
        /* 99 NIGHTS: CORE KERNEL V100 */
        @import url('https://fonts.googleapis.com/css2?family=Monoton&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            --neon-green: #00ff00;
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --gold: #ffd700;
            --blood-red: #ff0000;
            --dark-bg: #000000;
        }

        body {
            background-color: #000;
            color: var(--neon-green);
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 40px 0;
            overflow-y: auto;
        }

        #flash-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.1s;
        }

        #game-frame {
            width: 900px;
            background: #050505;
            border: 4px solid var(--neon-green);
            padding: 30px;
            box-shadow: 0 0 40px rgba(0, 255, 0, 0.15);
            position: relative;
            z-index: 5;
            margin-bottom: 40px;
        }

        h1 {
            font-family: 'Monoton';
            color: var(--neon-blue);
            font-size: 4em;
            text-align: center;
            margin: 0 0 20px 0;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .header-stats {
            display: flex;
            justify-content: space-between;
            font-family: 'Orbitron';
            border-bottom: 2px solid var(--neon-blue);
            padding: 10px 0;
            margin-bottom: 20px;
        }

        #visual-arena {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .view-box {
            background: #0a0a0a;
            border: 1px solid #333;
            height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .sprite { font-size: 80px; margin-bottom: 10px; }
        .char-label { font-family: 'Press Start 2P'; font-size: 8px; color: #555; }

        .system-bar {
            width: 100%;
            height: 42px;
            background: #111;
            border: 1px solid var(--neon-green);
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill { height: 100%; width: 100%; transition: width 0.4s ease; }
        .hp-fill { background: linear-gradient(90deg, #800, #f00); }
        .eat-fill { background: linear-gradient(90deg, #840, #f90); }
        .kn-fill { background: linear-gradient(90deg, #008, #00f); }
        .gr-fill { background: linear-gradient(90deg, #080, #0f0); }

        .bar-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            z-index: 10;
        }

        .bar-text {
            font-family: 'Orbitron';
            font-weight: 900;
            color: #fff;
            text-shadow: 1px 1px 2px #000;
            font-size: 0.8em;
            letter-spacing: 2px;
        }

        #system-log {
            height: 120px;
            overflow-y: scroll;
            background: #000;
            border: 1px solid #222;
            padding: 10px;
            font-size: 0.8em;
            margin-bottom: 20px;
        }

        .log-entry { margin-bottom: 4px; border-left: 2px solid var(--neon-green); padding-left: 8px; }

        .btn-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        button {
            background: #000;
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            padding: 15px;
            font-family: 'Orbitron';
            cursor: pointer;
            text-transform: uppercase;
        }

        button:hover:not(:disabled) { background: var(--neon-green); color: #000; }
        button:disabled { border-color: #333; color: #333; cursor: not-allowed; }

        .full-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: #000;
            z-index: 999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        #death-screen { background: rgba(20, 0, 0, 0.95); border: 10px solid var(--blood-red); color: white; }

        .index-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; width: 800px; }
        .idx-list { text-align: left; line-height: 2; font-size: 0.9em; color: #444; }
        .idx-item-won { color: var(--gold); font-weight: bold; }

        .combat-container { width: 700px; text-align: center; }
        #f-log {
            height: 150px; width: 100%; background: #050505; border: 1px solid var(--blood-red);
            margin: 20px 0; padding: 15px; overflow-y: auto; color: #eee; text-align: left; font-size: 0.85em;
        }

        .tut-box { 
            max-width: 650px; 
            max-height: 400px; 
            overflow-y: auto; 
            text-align: left; 
            background: #0a0a0a; 
            border: 1px solid #333; 
            padding: 25px; 
            line-height: 1.6; 
            font-size: 0.85em; 
            color: #aaa; 
            margin-bottom: 20px; 
        }
        .tut-box b { color: var(--neon-blue); }
        .tut-box i { color: var(--neon-pink); }

        #neural-hint {
            font-family: 'Orbitron';
            color: var(--neon-pink);
            font-size: 11px;
            margin-bottom: 5px;
            height: 15px;
            text-transform: uppercase;
        }

    </style>
</head>
<body>

<div id="flash-overlay"></div>

<div id="game-frame">
    <h1>99 NIGHTS</h1>
    
    <div class="header-stats">
        <span>OS_V100_STABLE</span>
        <span>NIGHT: <span id="n-val">0</span></span>
        <span>AP: <span id="ap-val">2</span></span>
    </div>

    <div id="visual-arena">
        <div class="view-box"><div class="sprite">ðŸ‘¤</div><div class="char-label">UNIT_01</div></div>
        <div class="view-box">
            <div style="position:absolute; top:10px; right:10px; color:var(--neon-pink); font-family:'Orbitron'; font-size: 10px;" id="q-val">STK: 0</div>
            <div class="sprite" id="e-ico">?</div>
            <div class="char-label" id="e-name">SCANNING</div>
        </div>
    </div>

    <div class="system-bar">
        <div class="bar-fill hp-fill" id="b-hp"></div>
        <div class="bar-overlay"><span class="bar-text">HEALTH: <span id="t-hp">100</span>%</span></div>
    </div>
    <div class="system-bar">
        <div class="bar-fill eat-fill" id="b-eat"></div>
        <div class="bar-overlay"><span class="bar-text">FOOD: <span id="t-eat">100</span>%</span></div>
    </div>
    <div class="system-bar">
        <div class="bar-fill kn-fill" id="b-kn"></div>
        <div class="bar-overlay"><span class="bar-text">STUDY: <span id="t-kn">0</span>/500</span></div>
    </div>
    <div class="system-bar">
        <div class="bar-fill gr-fill" id="b-gr"></div>
        <div class="bar-overlay"><span class="bar-text">GEAR: <span id="t-gr">20</span>%</span></div>
    </div>

    <div id="system-log"></div>

    <div class="btn-grid" id="main-ui" style="display:none;">
        <button onclick="Kernel.act('fight')">ENGAGE</button>
        <button onclick="Kernel.act('eat')">EAT (1 AP)</button>
        <button onclick="Kernel.act('study')">STUDY (1 AP)</button>
        <button onclick="Kernel.act('gear')">REPAIR (1 AP)</button>
        <button id="next-btn" onclick="Kernel.next()" style="grid-column: span 2; border-color: var(--neon-blue); color: var(--neon-blue);">NEXT NIGHT</button>
        <button onclick="Kernel.openIdx(true)" style="grid-column: span 2; border-color: var(--gold); color: var(--gold);">OPEN INDEX</button>
    </div>
</div>

<div id="fight-screen" class="full-overlay">
    <div class="combat-container">
        <h2 id="f-head" style="font-family:'Monoton'; font-size:3.5em; color:var(--blood-red); margin:0;">CLASH</h2>
        <div id="neural-hint"></div>
        <div class="system-bar"><div class="bar-fill hp-fill" id="f-p"></div><div class="bar-overlay"><span class="bar-text">PLAYER</span></div></div>
        <div class="system-bar"><div class="bar-fill" id="f-e" style="background:var(--blood-red);"></div><div class="bar-overlay"><span class="bar-text" id="f-e-name">TARGET</span></div></div>
        <div id="f-log"></div>
        <div class="btn-grid" id="f-btns">
            <button onclick="Kernel.strike('punch')">PUNCH</button>
            <button onclick="Kernel.strike('dodge')">DODGE</button>
        </div>
    </div>
</div>

<div id="death-screen" class="full-overlay">
    <h1 style="color:var(--blood-red); font-size:6em;">LINK SEVERED</h1>
    <h3 id="death-reason" style="font-family:'Press Start 2P'; color:#fff; margin-bottom: 30px;">SYSTEM FAILURE</h3>
    <button onclick="location.reload()" style="padding: 20px 60px; border-color: white; color: white;">REBOOT KERNEL</button>
</div>

<div id="index-screen" class="full-overlay">
    <h2 style="font-family:'Monoton'; color:var(--gold); font-size:3em;">REGISTRY</h2>
    <div class="index-wrapper">
        <div class="idx-col">
            <h3 style="font-family:'Press Start 2P'; font-size:10px; color:var(--neon-blue);">PURGED</h3>
            <div id="idx-y" class="idx-list"></div>
        </div>
        <div class="idx-col">
            <h3 style="font-family:'Press Start 2P'; font-size:10px; color:#555;">MISSING</h3>
            <div id="idx-n" class="idx-list"></div>
        </div>
    </div>
    <button onclick="Kernel.openIdx(false)" style="margin-top:40px; padding: 20px 60px;">BACK TO CORE</button>
</div>

<div id="start-screen" class="full-overlay" style="display:flex;">
    <h1 style="font-size:5em;">99 NIGHTS</h1>
    <div class="tut-box">
        <h3 style="color:var(--neon-green); margin-top:0;">SYSTEM MANUAL V1.0</h3>
        <b>1. CORE LOOP:</b> Each night, a new Brainrot is spawned into the STACK (STK). If the stack reaches 4 enemies, you are forced into combat. Use <i>NEXT NIGHT</i> to advance, which restores 100% Health and 2 Action Points (AP).<br><br>
        
        <b>2. ACTION POINTS (AP):</b> Every action (Eat, Study, Repair) costs 1 AP. Use them wisely before ending the night.<br><br>
        
        <b>3. VITAL SYSTEMS:</b>
        <br>â€¢ <b>Health:</b> If this hits 0, the link is severed. Resets every night.
        <br>â€¢ <b>Food:</b> Drops over time. If it hits 0, you take constant starvation damage.
        <br>â€¢ <b>Gear:</b> Your defense rating. Higher Gear reduces the damage you take in combat.
        <br>â€¢ <b>Study:</b> Increases your <i>Neural Prediction</i> sync rate.<br><br>
        
        <b>4. COMBAT MECHANICS:</b>
        <br>â€¢ <b>Punch:</b> Deals 30 DMG. Has a 50% hit chance.
        <br>â€¢ <b>Dodge:</b> You deal 0 DMG but have a high chance to avoid incoming attacks.
        <br>â€¢ <b>Damage:</b> Regulars deal 22 DMG. Bosses deal 40 DMG.<br><br>
        
        <b>5. NEURAL PREDICTION:</b> <i>(Key Strategy)</i> Higher Study points increase the chance that the system will predict the enemy's next move. At 500 Study, predictions are constant. Use this to decide when to Dodge or Punch.<br><br>
        
        <b>6. THE REGISTRY:</b> Defeating unique enemies saves them to your permanent registry. Defeat all 30 to unlock the Night 15 Skip.
    </div>
    <div id="save-info" style="color:var(--gold); font-family:'Orbitron'; font-size:12px; margin-bottom: 20px;"></div>
    <button onclick="Kernel.boot()" style="padding: 20px 60px;">SYNC NEURAL LINK</button>
</div>

<script>
const Kernel = {
    master: ["Noobini Pizzanini", "Lirili Larila", "Talpa Di Fero", "Pipi Kiwi", "Bandito Bobritto", "Boneca Ambalabu", "Cacto Hipopotamo", "Ta Ta Ta Ta Sahur", "Brr Brr Patapim", "Bananita Dolfinita", "Avocadini Antilopini", "Ti Ti Ti Sahur", "Chimpanzini Bananini", "Cocosini Mama", "Pipi Watermelon", "Chef Crabracadabra", "Tralalero Tralala", "Tung Tung Tung Sahur", "Ballerina Cappuccina", "Orcalero Orcala", "Pakrahmatmamat", "Elefanto Frigo", "Gorillone Subwoofero", "Dragon Cannelloni", "Spaghetti Tualetti", "Agarrini La Palini", "Nuclearo Dinossauro", "Garama and Madundung", "Strawberry Elephant", "Meowl"],

    s: { n:0, hp:100, eat:100, kn:0, gr:20, ap:2, queue:[], active:false, combat:false, dead:false },

    boot: function() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('main-ui').style.display = 'grid';
        this.s.active = true;
        this.next();
        setInterval(() => this.tick(), 4000);
    },

    tick: function() {
        if(!this.s.active || this.s.combat || this.s.dead) return;
        this.s.eat -= 0.8;
        if(this.s.eat <= 0) { 
            this.s.eat = 0; this.s.hp -= 2.5; 
            this.flash('rgba(255,0,0,0.4)'); 
            if(this.s.hp <= 0) this.die("CRITICAL STARVATION");
        }
        this.sync();
    },

    die: function(reason) {
        this.s.dead = true; this.s.hp = 0; this.sync();
        document.getElementById('death-reason').innerText = reason;
        document.getElementById('death-screen').style.display = 'flex';
    },

    flash: function(color) {
        const o = document.getElementById('flash-overlay');
        o.style.backgroundColor = color; o.style.opacity = '1';
        setTimeout(() => o.style.opacity = '0', 150);
    },

    sync: function() {
        document.getElementById('n-val').innerText = this.s.n;
        document.getElementById('ap-val').innerText = this.s.ap;
        document.getElementById('t-hp').innerText = Math.floor(this.s.hp);
        document.getElementById('t-eat').innerText = Math.floor(this.s.eat);
        document.getElementById('t-kn').innerText = this.s.kn;
        document.getElementById('t-gr').innerText = Math.floor(this.s.gr);
        document.getElementById('b-hp').style.width = this.s.hp + "%";
        document.getElementById('b-eat').style.width = this.s.eat + "%";
        document.getElementById('b-kn').style.width = (this.s.kn/500*100) + "%";
        document.getElementById('b-gr').style.width = this.s.gr + "%";
        document.getElementById('q-val').innerText = `STK: ${this.s.queue.length}`;
        if(this.s.queue.length > 0) {
            document.getElementById('e-name').innerText = this.s.queue[0].name;
            document.getElementById('e-ico').innerText = this.s.queue[0].ico;
        } else {
            document.getElementById('e-name').innerText = "IDLE";
            document.getElementById('e-ico').innerText = "âœ…";
        }
    },

    next: function() {
        this.s.n++; this.s.ap = 2; this.s.hp = 100;
        this.log(`Night ${this.s.n} online.`);
        let f = false;
        this.s.queue.forEach(t => { t.d++; if(t.d >= 4) f = true; });
        this.spawn();
        if(f) { this.log("QUEUE LIMIT EXCEEDED."); setTimeout(()=>this.openFight(), 600); }
        this.sync();
    },

    spawn: function() {
        const r = Math.random() * 100;
        let t;
        if(this.s.n > 7) {
            if(r < 1.5) t = { name: "Strawberry Elephant", hp: 1000, ico: "ðŸ˜ðŸ“", d: 0, boss: true };
            else if(r < 3.0) t = { name: "Meowl", hp: 700, ico: "ðŸ¦‰ðŸˆ", d: 0, boss: true };
        }
        if(!t) {
            const list = this.master.filter(n => n !== "Strawberry Elephant" && n !== "Meowl");
            t = { name: list[Math.floor(Math.random()*list.length)], hp: 150, ico: "ðŸ§ ", d: 0, boss: false };
        }
        this.s.queue.push(t);
        this.log(`New Target: ${t.name}`);
    },

    act: function(type) {
        if(this.s.dead) return;
        if(type === 'fight') { if(this.s.queue.length > 0) this.openFight(); return; }
        if(this.s.ap <= 0) return;
        if(type === 'eat') { this.s.eat = Math.min(100, this.s.eat + 40); this.flash('rgba(0,255,0,0.2)'); }
        if(type === 'study') { this.s.kn = Math.min(500, this.s.kn + 50); this.flash('rgba(0,255,255,0.2)'); }
        if(type === 'gear') { this.s.gr = Math.min(100, this.s.gr + 30); this.flash('rgba(0,255,0,0.2)'); }
        this.s.ap--; this.sync();
    },

    openFight: function() {
        const t = this.s.queue[0]; this.s.combat = true;
        this.c = { eHP: t.hp, eMax: t.hp, pHP: this.s.hp, dead: false };
        document.getElementById('fight-screen').style.display = 'flex';
        document.getElementById('f-e-name').innerText = t.name;
        document.getElementById('f-head').innerText = t.boss ? "BOSS" : "CLASH";
        document.getElementById('f-log').innerHTML = "Initializing...";
        document.getElementById('f-btns').style.display = 'grid';
        this.predict();
        this.syncF();
    },

    predict: function() {
        const h = document.getElementById('neural-hint');
        h.innerText = "";
        let success = Math.random() * 500 < this.s.kn;
        if(success && this.s.queue[0]) {
            const target = this.s.queue[0];
            const prob = 50 + Math.floor(Math.random() * 40); 
            this._nextRoll = Math.random();
            const action = this._nextRoll > 0.5 ? "DODGE" : "ATTACK";
            h.innerText = `>>> ${prob}% PROBABILITY: ${target.name} WILL ${action}`;
        }
    },

    syncF: function() {
        document.getElementById('f-p').style.width = this.c.pHP + "%";
        document.getElementById('f-e').style.width = (this.c.eHP/this.c.eMax*100) + "%";
    },

    strike: function(move) {
        if(this.c.dead || this.s.dead) return;
        let l = "";
        const target = this.s.queue[0];

        if(move === 'punch') {
            if(Math.random() > 0.5) {
                this.c.eHP -= 30; l += `<div>> HIT! Dealt 30 DMG.</div>`;
            } else { l += `<div>> MISS! Target evaded.</div>`; }
        } else if(move === 'dodge') {
            l += `<div style="color:var(--neon-blue)">> FOCUSING ON DEFENSE.</div>`;
        }

        let enemyDmg = target.boss ? 40 : 22;
        let roll = this._nextRoll !== undefined ? this._nextRoll : Math.random();
        this._nextRoll = undefined;

        if(move === 'dodge' && roll > 0.2) {
            l += `<div style="color:var(--gold)">> DODGED! No damage taken.</div>`;
        } else {
            if(roll > 0.5) { 
                let d = enemyDmg * (1 - (this.s.gr/250));
                this.c.pHP -= d; this.s.hp -= d;
                l += `<div style="color:red">> TOOK ${Math.floor(d)} DMG.</div>`;
                this.flash('rgba(255,0,0,0.3)');
            } else {
                l += `<div>> TARGET MISSED.</div>`;
            }
        }
        
        document.getElementById('f-log').innerHTML = l + document.getElementById('f-log').innerHTML;
        this.syncF(); this.sync();

        if(this.s.hp <= 0) { this.die(`TERMINATED BY ${target.name.toUpperCase()}`); return; }

        if(this.c.eHP <= 0) {
            this.c.eHP = 0; this.syncF(); this.c.dead = true;
            document.getElementById('f-btns').style.display = 'none';
            document.getElementById('f-log').innerHTML = `<div style="color:var(--gold)">TARGET DEFEATED.</div>` + document.getElementById('f-log').innerHTML;
            setTimeout(() => {
                const v = this.s.queue.shift();
                this.record(v.name); this.s.combat = false;
                document.getElementById('fight-screen').style.display = 'none';
                this.log(`Purged: ${v.name}`);
            }, 2000);
        } else {
            this.predict();
        }
    },

    record: function(n) {
        let h = JSON.parse(localStorage.getItem('br_v100') || "[]");
        if(!h.includes(n)) h.push(n);
        localStorage.setItem('br_v100', JSON.stringify(h));
    },

    openIdx: function(show) {
        if(show) {
            const k = JSON.parse(localStorage.getItem('br_v100') || "[]");
            const y = document.getElementById('idx-y'), n = document.getElementById('idx-n');
            y.innerHTML = ""; n.innerHTML = "";
            this.master.forEach(r => {
                if(k.includes(r)) y.innerHTML += `<div class="idx-item-won">${r}</div>`;
                else n.innerHTML += `<div>${r}</div>`;
            });
            document.getElementById('index-screen').style.display = 'flex';
        } else { document.getElementById('index-screen').style.display = 'none'; }
    },

    log: function(m) { 
        const l = document.getElementById('system-log'); 
        l.innerHTML = `<div class="log-entry">${m}</div>` + l.innerHTML; 
    }
};

window.onload = () => {
    const k = JSON.parse(localStorage.getItem('br_v100') || "[]");
    document.getElementById('save-info').innerText = `DATABASE: ${k.length} / ${Kernel.master.length} DEFEATED`;
};
</script>
</body>
</html>
