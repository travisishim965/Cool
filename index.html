<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>99 NIGHTS: KERNEL V2.0 ULTRA</title>
    <style>
        /* 99 NIGHTS - KERNEL V2.0 ULTRA
           CORE ENGINE: BRAINROT_OS_MODULAR
        */
        :root {
            --neon-green: #00ff00;
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --gold: #ffd700;
            --blood-red: #ff0000;
            --deep-black: #000000;
            --glass: rgba(0, 255, 0, 0.05);
        }

        * { box-sizing: border-box; outline: none; }

        body {
            background: var(--deep-black);
            color: var(--neon-green);
            font-family: 'Courier New', monospace;
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            user-select: none;
        }

        /* --- VISUAL EFFECTS ENGINE --- */
        #vfx-layer {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            pointer-events: none;
            z-index: 100000;
            opacity: 0;
            transition: opacity 0.1s;
        }

        /* --- PRIMARY INTERFACE --- */
        #kernel-shell {
            width: 950px;
            max-width: 98vw;
            border: 2px solid var(--neon-green);
            background: #050505;
            padding: 30px;
            position: relative;
            box-shadow: 0 0 40px rgba(0, 255, 0, 0.1);
        }

        header {
            text-align: center;
            border-bottom: 2px solid var(--neon-blue);
            padding-bottom: 20px;
            margin-bottom: 25px;
        }

        header h1 {
            font-size: 4.5em;
            margin: 0;
            color: var(--neon-blue);
            letter-spacing: 15px;
            text-shadow: 0 0 15px var(--neon-blue);
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            font-weight: 900;
            font-size: 1.1em;
            margin-top: 10px;
        }

        /* --- UNIT DISPLAY --- */
        .combat-arena {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .unit-card {
            background: #080808;
            border: 1px solid #1a1a1a;
            height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .sprite-wrap { font-size: 100px; filter: drop-shadow(0 0 10px var(--neon-green)); }
        .unit-meta { font-size: 12px; color: #444; margin-top: 15px; letter-spacing: 2px; }
        .queue-tag { position: absolute; top: 10px; right: 15px; color: var(--neon-pink); font-size: 14px; }

        /* --- RESOURCE SYSTEM --- */
        .resource-group { margin-bottom: 25px; }
        .bar-container {
            width: 100%; height: 45px;
            background: #111;
            border: 1px solid var(--neon-green);
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill { height: 100%; width: 100%; transition: width 0.4s cubic-bezier(0.1, 0.7, 0.1, 1); }
        .hp-fill { background: linear-gradient(90deg, #600, #ff0000); }
        .et-fill { background: linear-gradient(90deg, #640, #ffaa00); }
        .kn-fill { background: linear-gradient(90deg, #004, #0088ff); }
        .gr-fill { background: linear-gradient(90deg, #040, #00ff66); }

        .bar-label {
            position: absolute; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; color: #fff; text-shadow: 1px 1px 3px #000;
            pointer-events: none; font-size: 0.9em;
        }

        /* --- LOGGING --- */
        #system-log {
            height: 120px;
            overflow-y: auto;
            background: #000;
            border: 1px solid #111;
            padding: 15px;
            font-size: 13px;
            margin-bottom: 25px;
            color: #888;
        }
        .log-entry { margin-bottom: 5px; border-left: 3px solid var(--neon-green); padding-left: 10px; }

        /* --- CONTROLS --- */
        .control-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        button {
            background: #000;
            color: var(--neon-green);
            border: 2px solid var(--neon-green);
            padding: 18px;
            font-weight: 900;
            cursor: pointer;
            font-family: inherit;
            transition: 0.15s;
        }
        button:hover:not(:disabled) { background: var(--neon-green); color: #000; }
        button:disabled { border-color: #222; color: #222; cursor: not-allowed; }

        /* --- FULL BLACKOUT OVERLAYS --- */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: var(--deep-black) !important;
            z-index: 99999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* CLASH SPECIFIC */
        #clash-ui { width: 700px; text-align: center; }
        #clash-log { 
            height: 150px; width: 100%; background: #050505; 
            border: 1px solid var(--blood-red); margin: 20px 0; 
            padding: 15px; overflow-y: auto; text-align: left;
        }

        /* REGISTRY SCROLL FIX */
        #registry-box {
            width: 800px; height: 80vh;
            border: 1px solid #222;
            display: flex; flex-direction: column;
        }
        #registry-scroll {
            flex-grow: 1; overflow-y: auto; padding: 30px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 40px;
        }
        .reg-col h3 { color: var(--neon-blue); border-bottom: 1px solid var(--neon-blue); padding-bottom: 10px; }
        .reg-item { font-size: 14px; margin-bottom: 10px; color: #333; }
        .captured { color: var(--gold); font-weight: bold; }
        .reg-foot { padding: 25px; background: #0a0a0a; border-top: 1px solid #222; text-align: center; }

        /* GAME OVER */
        .death-title { font-size: 6em; color: var(--blood-red); text-shadow: 0 0 20px var(--blood-red); margin: 0; }
    </style>
</head>
<body>

<div id="vfx-layer"></div>

<div id="kernel-shell">
    <header>
        <h1>99 NIGHTS</h1>
        <div class="status-row">
            <span>CORE_STABLE_V2.0</span>
            <span>NIGHT: <span id="val-n">0</span></span>
            <span>AP: <span id="val-ap">2</span></span>
        </div>
    </header>

    <div class="combat-arena">
        <div class="unit-card"><div class="sprite-wrap">ðŸ‘¤</div><div class="unit-meta">PLAYER_UNIT_01</div></div>
        <div class="unit-card">
            <div id="val-stack" class="queue-tag">STK: 0</div>
            <div class="sprite-wrap" id="val-ico">?</div>
            <div class="unit-meta" id="val-name">SCANNING...</div>
        </div>
    </div>

    <div class="resource-group">
        <div class="bar-container"><div class="bar-fill hp-fill" id="b-hp"></div><div class="bar-label">VITALITY: <span id="t-hp">100</span>%</div></div>
        <div class="bar-container"><div class="bar-fill et-fill" id="b-et"></div><div class="bar-label">CALORIES: <span id="t-et">100</span>%</div></div>
        <div class="bar-container"><div class="bar-fill kn-fill" id="b-kn"></div><div class="bar-label">KNOWLEDGE: <span id="t-kn">0</span>/500</div></div>
        <div class="bar-container"><div class="bar-fill gr-fill" id="b-gr"></div><div class="bar-label">ARMOR: <span id="t-gr">20</span>%</div></div>
    </div>

    <div id="system-log"></div>

    <div class="control-grid" id="ui-core" style="display:none">
        <button onclick="Engine.act('fight')">ENGAGE TARGET</button>
        <button onclick="Engine.act('eat')">RESTORE CALORIES</button>
        <button onclick="Engine.act('study')">EXTRACT DATA</button>
        <button onclick="Engine.act('gear')">REPAIR ARMOR</button>
        <button onclick="Engine.nextNight()" style="grid-column: span 2; color: var(--neon-blue); border-color: var(--neon-blue);">ADVANCE NIGHT CYCLE</button>
        <button onclick="Engine.toggleRegistry(true)" style="grid-column: span 2; color: var(--gold); border-color: var(--gold);">OPEN REGISTRY</button>
    </div>
</div>

<div id="screen-clash" class="overlay">
    <div id="clash-ui">
        <h2 id="f-head" style="font-size:4em; color:var(--blood-red); margin:0 0 20px 0;">CLASH</h2>
        <div class="bar-container"><div class="bar-fill hp-fill" id="f-p-b"></div><div class="bar-label">PLAYER</div></div>
        <div class="bar-container"><div class="bar-fill" id="f-e-b" style="background:var(--blood-red)"></div><div class="bar-label" id="f-e-name">TARGET</div></div>
        <div id="clash-log"></div>
        <div class="control-grid" id="f-btns">
            <button onclick="Engine.strike()">STRIKE</button>
            <button onclick="Engine.strike()">PARRY</button>
        </div>
    </div>
</div>

<div id="screen-registry" class="overlay">
    <div id="registry-box">
        <div id="registry-scroll">
            <div class="reg-col"><h3>PURGED</h3><div id="reg-yes"></div></div>
            <div class="reg-col"><h3>MISSING</h3><div id="reg-no"></div></div>
        </div>
        <div class="reg-foot"><button onclick="Engine.toggleRegistry(false)" style="padding: 15px 100px;">BACK TO CORE</button></div>
    </div>
</div>

<div id="screen-dead" class="overlay">
    <h1 class="death-title">FAILURE</h1>
    <div style="text-align:center; margin: 40px 0; font-size: 1.5em; line-height: 2;">
        SURVIVED: <span id="end-n" style="color:var(--neon-blue)">0</span> NIGHTS<br>
        PURGED: <span id="end-p" style="color:var(--gold)">0</span> BRAINROTS
    </div>
    <button onclick="location.reload()" style="padding: 20px 100px; border-color: var(--blood-red); color: var(--blood-red);">REBOOT SYSTEM</button>
</div>

<div id="screen-boot" class="overlay" style="display:flex">
    <h1 style="color:var(--neon-blue); font-size: 4em;">BOOT_SEQUENCE</h1>
    <div style="max-width:600px; padding:30px; background:#0a0a0a; border:1px solid #222; font-size:14px; line-height:1.6; color:#888;">
        [<b>COMBAT</b>]: 50% hit probability for both entities. Simultaneous damage.<br><br>
        [<b>PURGE</b>]: Upon enemy HP hitting 0, the system locks for 2 seconds to witness the deletion.<br><br>
        [<b>PERSISTENCE</b>]: Defeating all 30 unique threats unlocks a permanent Night 15 shortcut.
    </div>
    <div id="boot-status" style="margin: 20px 0; color:var(--gold); font-weight:900;"></div>
    <button onclick="Engine.boot()" style="padding: 20px 100px;">INITIALIZE CORE</button>
</div>

<script>
const Engine = {
    master: ["Noobini Pizzanini", "Lirili Larila", "Talpa Di Fero", "Pipi Kiwi", "Bandito Bobritto", "Boneca Ambalabu", "Cacto Hipopotamo", "Ta Ta Ta Ta Sahur", "Brr Brr Patapim", "Bananita Dolfinita", "Avocadini Antilopini", "Ti Ti Ti Sahur", "Chimpanzini Bananini", "Cocosini Mama", "Pipi Watermelon", "Chef Crabracadabra", "Tralalero Tralala", "Tung Tung Tung Sahur", "Ballerina Cappuccina", "Orcalero Orcala", "Pakrahmatmamat", "Elefanto Frigo", "Gorillone Subwoofero", "Dragon Cannelloni", "Spaghetti Tualetti", "Agarrini La Palini", "Nuclearo Dinossauro", "Garama and Madundung", "Strawberry Elephant", "Meowl"],

    s: { n:0, hp:100, et:100, kn:0, gr:20, ap:2, q:[], active:false, cbt:false },

    boot: function() {
        document.getElementById('screen-boot').style.display = 'none';
        document.getElementById('ui-core').style.display = 'grid';
        this.s.active = true;
        const h = JSON.parse(localStorage.getItem('nn_v2_save') || "[]");
        if(this.master.every(x => h.includes(x))) { this.s.n = 14; this.addLog("REGISTRY COMPLETE: Jumping to Night 15."); }
        this.nextNight();
        setInterval(() => this.cycle(), 4500);
    },

    cycle: function() {
        if(!this.s.active || this.s.cbt) return;
        this.s.et -= 0.8;
        if(this.s.et <= 0) { this.s.et = 0; this.s.hp -= 1.7; this.fx('rgba(255,0,0,0.2)'); }
        this.sync();
    },

    fx: function(c) {
        const l = document.getElementById('vfx-layer'); l.style.background = c; l.style.opacity = '1';
        setTimeout(() => l.style.opacity = '0', 150);
    },

    sync: function() {
        document.getElementById('val-n').innerText = this.s.n;
        document.getElementById('val-ap').innerText = this.s.ap;
        document.getElementById('t-hp').innerText = Math.floor(this.s.hp);
        document.getElementById('t-et').innerText = Math.floor(this.s.et);
        document.getElementById('t-kn').innerText = this.s.kn;
        document.getElementById('t-gr').innerText = Math.floor(this.s.gr);
        document.getElementById('b-hp').style.width = this.s.hp + "%";
        document.getElementById('b-et').style.width = this.s.et + "%";
        document.getElementById('b-kn').style.width = (this.s.kn/500*100) + "%";
        document.getElementById('b-gr').style.width = this.s.gr + "%";
        document.getElementById('val-stack').innerText = "STK: " + this.s.q.length;
        if(this.s.q.length > 0) {
            document.getElementById('val-name').innerText = this.s.q[0].n;
            document.getElementById('val-ico').innerText = this.s.q[0].i;
        } else {
            document.getElementById('val-name').innerText = "SYSTEM_IDLE";
            document.getElementById('val-ico').innerText = "âœ…";
        }
        if(this.s.hp <= 0) this.triggerDeath();
    },

    triggerDeath: function() {
        this.s.active = false;
        const h = JSON.parse(localStorage.getItem('nn_v2_save') || "[]");
        document.getElementById('end-n').innerText = this.s.n;
        document.getElementById('end-p').innerText = h.length + "/" + this.master.length;
        document.getElementById('screen-dead').style.display = 'flex';
    },

    nextNight: function() {
        this.s.n++; this.s.ap = 2;
        let forced = false;
        this.s.q.forEach(t => { t.d++; if(t.d >= 4) forced = true; });
        this.spawn();
        if(forced) { this.addLog("CRITICAL: Queue Overload. Forced Combat Initiated."); setTimeout(() => this.openClash(), 600); }
        this.sync();
    },

    spawn: function() {
        let r = Math.random()*100, t;
        if(this.s.n > 7 && r < 3) {
            t = { n: r < 1.5 ? "Strawberry Elephant" : "Meowl", h: 800, i: "ðŸ‘¹", d: 0, boss: true };
        } else {
            t = { n: this.master[Math.floor(Math.random()*28)], h: 160, i: "ðŸ§ ", d: 0, boss: false };
        }
        this.s.q.push(t);
        this.addLog("New Signature Detected: " + t.n);
    },

    act: function(type) {
        if(type === 'fight') { if(this.s.q.length > 0) this.openClash(); return; }
        if(this.s.ap <= 0) return;
        if(type === 'eat') { this.s.et = Math.min(100, this.s.et + 40); this.fx('rgba(0,255,0,0.2)'); }
        if(type === 'study') { this.s.kn = Math.min(500, this.s.kn + 50); this.fx('rgba(0,255,255,0.2)'); }
        if(type === 'gear') { this.s.gr = Math.min(100, this.s.gr + 30); this.fx('rgba(0,255,0,0.2)'); }
        this.s.ap--; this.sync();
    },

    openClash: function() {
        let t = this.s.q[0]; this.s.cbt = true;
        this.clash = { eh: t.h, em: t.h, ph: 100, lock: false };
        document.getElementById('screen-clash').style.display = 'flex';
        document.getElementById('f-e-name').innerText = t.n;
        document.getElementById('f-head').innerText = t.boss ? "BOSS CLASH" : "CLASH";
        document.getElementById('clash-log').innerHTML = "Neural link established...";
        document.getElementById('f-btns').style.display = 'grid';
        this.syncClash();
    },

    syncClash: function() {
        document.getElementById('f-p-b').style.width = this.clash.ph + "%";
        document.getElementById('f-e-b').style.width = (this.clash.eh / this.clash.em * 100) + "%";
    },

    strike: function() {
        if(this.clash.lock) return;
        let l = "";
        // 50% Logic
        if(Math.random() > 0.5) { this.clash.eh -= 40; l += "> HIT: Dealt 40 damage. "; } else l += "> MISS. ";
        if(Math.random() > 0.5) {
            let d = 20 * (1 - (this.s.gr/250));
            this.clash.ph -= d; this.s.hp -= d/4;
            l += "> TAKEN: " + Math.floor(d) + " damage.";
            this.fx('rgba(255,0,0,0.3)');
        }
        document.getElementById('clash-log').innerHTML = l + "<br>" + document.getElementById('clash-log').innerHTML;
        this.syncClash(); this.sync();
        if(this.clash.eh <= 0) {
            this.clash.eh = 0; this.syncClash(); this.clash.lock = true;
            document.getElementById('f-btns').style.display = 'none';
            document.getElementById('clash-log').innerHTML = "<b style='color:var(--gold)'>TARGET DELETED. STANDBY FOR DISCONNECT...</b><br>" + document.getElementById('clash-log').innerHTML;
            setTimeout(() => {
                let v = this.s.q.shift(); this.persist(v.n); this.s.cbt = false;
                document.getElementById('screen-clash').style.display = 'none';
                this.addLog("Neutralized: " + v.n);
            }, 2000);
        }
    },

    persist: function(name) {
        let h = JSON.parse(localStorage.getItem('nn_v2_save') || "[]");
        if(!h.includes(name)) h.push(name);
        localStorage.setItem('nn_v2_save', JSON.stringify(h));
    },

    toggleRegistry: function(open) {
        if(open) {
            let h = JSON.parse(localStorage.getItem('nn_v2_save') || "[]");
            let yes = document.getElementById('reg-yes'), no = document.getElementById('reg-no');
            yes.innerHTML = ""; no.innerHTML = "";
            this.master.forEach(x => {
                if(h.includes(x)) yes.innerHTML += `<div class="reg-item captured">${x}</div>`;
                else no.innerHTML += `<div class="reg-item">${x}</div>`;
            });
            document.getElementById('screen-registry').style.display = 'flex';
        } else document.getElementById('screen-registry').style.display = 'none';
    },

    addLog: function(m) {
        const log = document.getElementById('system-log');
        log.innerHTML = `<div class="log-entry">${m}</div>` + log.innerHTML;
    }
};

window.onload = () => {
    const h = JSON.parse(localStorage.getItem('nn_v2_save') || "[]");
    document.getElementById('boot-status').innerText = `DATA_RECOVERY: ${h.length}/${Engine.master.length} PURGED`;
};
</script>
</body>
</html>
