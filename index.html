<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>99 NIGHTS: LEGACY KERNEL V90.0</title>
    <style>
        /* 99 NIGHTS: CORE KERNEL V90.0 
           STRICT LINE COUNT TARGET: 850+
           ENGINE: BRAINROT_OS_BETA
        */
        @import url('https://fonts.googleapis.com/css2?family=Monoton&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            --neon-green: #00ff00;
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --gold: #ffd700;
            --blood-red: #ff0000;
            --dark-bg: #050505;
        }

        body {
            background-color: #000;
            color: var(--neon-green);
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }

        /* --- UI CONTAINER --- */
        #game-frame {
            width: 95%;
            max-width: 1000px;
            background: var(--dark-bg);
            border: 5px solid var(--neon-green);
            padding: 30px;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.2);
            position: relative;
        }

        h1 {
            font-family: 'Monoton', cursive;
            color: var(--neon-blue);
            font-size: 4.5em;
            text-align: center;
            margin: 0;
            text-shadow: 0 0 15px var(--neon-blue);
        }

        .header-stats {
            display: flex;
            justify-content: space-between;
            font-family: 'Orbitron', sans-serif;
            border-bottom: 2px solid var(--neon-blue);
            padding: 10px 0;
            margin-bottom: 25px;
            font-size: 1.1em;
        }

        /* --- VISUAL ARENA --- */
        #visual-arena {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .view-box {
            background: #111;
            border: 2px solid var(--neon-green);
            height: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .sprite { font-size: 100px; margin-bottom: 15px; transition: transform 0.1s; }
        .char-label { font-family: 'Press Start 2P'; font-size: 8px; color: #777; letter-spacing: 1px; }

        /* --- SYSTEM BARS (FIXED TEXT OVERLAP) --- */
        .system-bar {
            width: 100%;
            height: 44px; 
            background: #151515;
            border: 1px solid var(--neon-green);
            margin-bottom: 18px;
            position: relative;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            width: 100%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hp-fill { background: linear-gradient(90deg, #600, #f00); box-shadow: 0 0 10px #f00; }
        .eat-fill { background: linear-gradient(90deg, #630, #f90); }
        .kn-fill { background: linear-gradient(90deg, #006, #00f); }
        .gr-fill { background: linear-gradient(90deg, #060, #0f0); }

        .bar-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            z-index: 10; pointer-events: none;
        }

        .bar-text {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            color: #fff;
            text-shadow: 2px 2px 4px #000;
            font-size: 0.85em;
            letter-spacing: 2px;
        }

        /* --- LOGGING & BUTTONS --- */
        #system-log {
            height: 150px;
            overflow-y: scroll;
            background: #000;
            border: 1px solid var(--neon-green);
            padding: 15px;
            font-size: 0.85em;
            margin-bottom: 25px;
        }

        .log-entry { margin-bottom: 6px; border-left: 3px solid var(--neon-green); padding-left: 12px; }

        .btn-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        button {
            background: #001500;
            color: var(--neon-green);
            border: 2px solid var(--neon-green);
            padding: 18px;
            font-family: 'Orbitron';
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        button:hover:not(:disabled) {
            background: var(--neon-green);
            color: #000;
        }

        #idx-btn { grid-column: span 2; border-color: var(--gold); color: var(--gold); margin-top: 10px; }
        #next-night-btn { grid-column: span 2; background: var(--neon-blue); color: #000; font-size: 1.1em; margin-top: 10px; }

        /* --- OVERLAYS --- */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98);
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }

        /* --- INDEX VIEW FIX --- */
        #index-screen {
            overflow-y: auto;
            display: none;
            justify-content: flex-start;
            padding-top: 100px;
        }

        .index-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            width: 100%;
            max-width: 900px;
            margin-bottom: 50px;
        }

        .idx-col h3 {
            font-family: 'Press Start 2P';
            font-size: 10px;
            color: var(--neon-blue);
            border-bottom: 2px solid var(--neon-blue);
            padding-bottom: 10px;
        }

        .name-row { text-align: left; font-size: 0.9em; line-height: 1.8; color: #444; }
        .name-row.unlocked { color: var(--gold); font-weight: bold; }

        /* --- TUTORIAL STYLING --- */
        .tut-container {
            max-width: 700px;
            text-align: left;
            background: #111;
            padding: 25px;
            border: 1px solid #333;
            color: #ccc;
            line-height: 1.6;
            font-size: 0.9em;
            margin-bottom: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .tut-container b { color: var(--neon-blue); }

    </style>
</head>
<body>

<div id="game-frame">
    <h1>99 NIGHTS</h1>
    
    <div class="header-stats">
        <span>BIOS: V90.0_LOADED</span>
        <span>NIGHT: <span id="n-val">0</span></span>
        <span>AP: <span id="ap-val">2</span></span>
    </div>

    <div id="visual-arena">
        <div class="view-box">
            <div class="sprite" id="p-sprite">ðŸ‘¤</div>
            <div class="char-label">PLAYER_UNIT</div>
        </div>
        <div class="view-box">
            <div style="position:absolute; top:15px; right:15px; color:var(--neon-pink); font-family:'Orbitron';" id="q-val">STK: 0</div>
            <div class="sprite" id="e-ico">?</div>
            <div class="char-label" id="e-name">SCANNING...</div>
        </div>
    </div>

    <div class="system-bar">
        <div class="bar-fill hp-fill" id="b-hp"></div>
        <div class="bar-overlay"><span class="bar-text">HEALTH: <span id="t-hp">100</span>%</span></div>
    </div>
    <div class="system-bar">
        <div class="bar-fill eat-fill" id="b-eat"></div>
        <div class="bar-overlay"><span class="bar-text">CALORIES: <span id="t-eat">100</span>%</span></div>
    </div>
    <div class="system-bar">
        <div class="bar-fill kn-fill" id="b-kn"></div>
        <div class="bar-overlay"><span class="bar-text">KNOWLEDGE: <span id="t-kn">0</span>/500</span></div>
    </div>
    <div class="system-bar">
        <div class="bar-fill gr-fill" id="b-gr"></div>
        <div class="bar-overlay"><span class="bar-text">GEAR: <span id="t-gr">20</span>%</span></div>
    </div>

    <div id="system-log"></div>

    <div class="btn-grid" id="main-ui" style="display:none;">
        <button onclick="Game.act('fight')">ENGAGE</button>
        <button onclick="Game.act('eat')">EAT (1 AP)</button>
        <button onclick="Game.act('study')">STUDY (1 AP)</button>
        <button onclick="Game.act('gear')">REPAIR (1 AP)</button>
        <button id="next-night-btn" onclick="Game.next()">ADVANCE NIGHT</button>
        <button id="idx-btn" onclick="Game.openIndex(true)">BRAINROT INDEX</button>
    </div>

    <div id="fight-screen" class="overlay">
        <h2 id="f-head" style="font-family:'Monoton'; font-size:3em; color:var(--blood-red);">CLASH</h2>
        <div style="width: 100%; max-width: 600px;">
            <div class="system-bar"><div class="bar-fill hp-fill" id="f-p-fill"></div><div class="bar-overlay"><span class="bar-text">PLAYER</span></div></div>
            <div class="system-bar"><div class="bar-fill" id="f-e-fill" style="background:var(--blood-red);"></div><div class="bar-overlay"><span class="bar-text" id="f-e-name">TARGET</span></div></div>
        </div>
        <div id="f-log" style="height:120px; width:100%; max-width:600px; background:#000; border:1px solid var(--blood-red); margin:20px 0; padding:15px; overflow-y:auto; color:#fff; font-size:0.8em;"></div>
        <div class="btn-grid" style="width:100%; max-width:600px;">
            <button onclick="Game.strike('PUNCH')">STRIKE</button>
            <button onclick="Game.strike('DODGE')">DODGE</button>
        </div>
    </div>

    <div id="index-screen" class="overlay">
        <h2 style="font-family:'Monoton'; color:var(--gold); margin-bottom: 20px;">BRAINROT INDEX</h2>
        <div class="index-grid">
            <div class="idx-col">
                <h3>DEFEATED</h3>
                <div id="idx-win" class="idx-list"></div>
            </div>
            <div class="idx-col">
                <h3>MISSING</h3>
                <div id="idx-loss" class="idx-list"></div>
            </div>
        </div>
        <button onclick="Game.openIndex(false)" style="padding: 20px 60px; border-color:var(--neon-blue); color:var(--neon-blue);">CLOSE INDEX</button>
    </div>

    <div id="start-screen" class="overlay" style="display:flex;">
        <h2 style="font-family:'Press Start 2P'; color:var(--neon-blue);">NEURAL SYNC</h2>
        <div class="tut-container">
            <b>1. CORE SURVIVAL:</b> Manage Food and Health. If Food drops to 0%, your Health will deplete over time. Gear reduces the damage you take during fights.<br><br>
            <b>2. COMBAT LOGIC:</b> Enemies appear in the queue. If an enemy stays in the queue for 4 nights, they will <b>FORCE</b> a fight. Fighting does not cost AP, but it is dangerous.<br><br>
            <b>3. BOSSES:</b> After Night 7, there is a <b>1.5% chance</b> to encounter legendary bosses like <b>Strawberry Elephant</b> or <b>Meowl</b>. They have high HP and require better gear.<br><br>
            <b>4. THE INDEX:</b> Use the Index button mid-game to see which Brainrots you've purged. This is saved permanently to your system.<br><br>
            <b>5. REWARD:</b> Purge all 30 unique Brainrots to unlock the <b>NIGHT 15 SKIP</b>. This skip allows you to start deeper into the game on your next run.
        </div>
        <div id="legacy-msg" style="color:var(--gold); margin-bottom:20px; font-family:'Orbitron'; font-size:11px;"></div>
        <button onclick="Game.boot()">BOOT NEURAL LINK</button>
    </div>

    <div id="victory-screen" class="overlay">
        <h2 style="font-family:'Monoton'; font-size:7em; color:var(--gold);">VICTORY</h2>
        <button onclick="location.reload()">RE-SYNC</button>
    </div>
</div>

<script>
const Game = {
    // MASTER DATABASE
    master: [
        "Noobini Pizzanini", "Lirili Larila", "Talpa Di Fero", "Pipi Kiwi", "Bandito Bobritto", 
        "Boneca Ambalabu", "Cacto Hipopotamo", "Ta Ta Ta Ta Sahur", "Brr Brr Patapim", 
        "Bananita Dolfinita", "Avocadini Antilopini", "Ti Ti Ti Sahur", "Chimpanzini Bananini", 
        "Cocosini Mama", "Pipi Watermelon", "Chef Crabracadabra", "Tralalero Tralala", 
        "Tung Tung Tung Sahur", "Ballerina Cappuccina", "Orcalero Orcala", "Pakrahmatmamat", 
        "Elefanto Frigo", "Gorillone Subwoofero", "Dragon Cannelloni", "Spaghetti Tualetti", 
        "Agarrini La Palini", "Nuclearo Dinossauro", "Garama and Madundung", "Strawberry Elephant", "Meowl"
    ],

    s: { n:0, hp:100, eat:100, kn:0, gr:20, ap:2, queue:[], active:false, combat:false },

    boot: function() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('main-ui').style.display = 'grid';
        this.s.active = true;

        // Legacy Check
        const history = JSON.parse(localStorage.getItem('br_v90') || "[]");
        if(this.master.every(r => history.includes(r))) {
            this.s.n = 14;
            this.log("COMPLETION DETECTED: Skipping to Night 15.");
        }
        
        this.next();
        setInterval(() => this.passive(), 4500);
    },

    passive: function() {
        if(!this.s.active || this.s.combat) return;
        this.s.eat -= 0.65;
        this.s.gr -= 0.12;
        if(this.s.eat <= 0) { this.s.eat = 0; this.s.hp -= 1.8; }
        this.sync();
    },

    sync: function() {
        document.getElementById('n-val').innerText = this.s.n;
        document.getElementById('ap-val').innerText = this.s.ap;
        document.getElementById('t-hp').innerText = Math.floor(this.s.hp);
        document.getElementById('t-eat').innerText = Math.floor(this.s.eat);
        document.getElementById('t-kn').innerText = this.s.kn;
        document.getElementById('t-gr').innerText = Math.floor(this.s.gr);

        document.getElementById('b-hp').style.width = this.s.hp + "%";
        document.getElementById('b-eat').style.width = this.s.eat + "%";
        document.getElementById('b-kn').style.width = (this.s.kn/500*100) + "%";
        document.getElementById('b-gr').style.width = this.s.gr + "%";

        document.getElementById('q-val').innerText = `STK: ${this.s.queue.length}`;
        if(this.s.queue.length > 0) {
            document.getElementById('e-name').innerText = this.s.queue[0].name;
            document.getElementById('e-ico').innerText = this.s.queue[0].ico;
        } else {
            document.getElementById('e-name').innerText = "CLEAN";
            document.getElementById('e-ico').innerText = "âœ…";
        }

        if(this.s.hp <= 0) location.reload();
        if(this.s.n >= 99 && !this.s.combat) document.getElementById('victory-screen').style.display = 'flex';
    },

    next: function() {
        this.s.n++;
        this.s.ap = 2;
        this.log(`Night ${this.s.n} started. Resources restored.`);

        let force = false;
        this.s.queue.forEach(t => { t.d++; if(t.d >= 4) force = true; });

        this.spawn();
        if(force) {
            this.log("CRITICAL: Queue overflow forced combat!");
            setTimeout(() => this.openFight(), 800);
        }
        this.sync();
    },

    spawn: function() {
        const roll = Math.random() * 100;
        let t;
        if(this.s.n > 7) {
            if(roll < 1.5) t = { name: "Strawberry Elephant", hp: 950, ico: "ðŸ˜ðŸ“", d: 0, boss: true };
            else if(roll < 3.0) t = { name: "Meowl", hp: 650, ico: "ðŸ¦‰ðŸˆ", d: 0, boss: true };
        }
        if(!t) {
            const list = this.master.filter(n => n !== "Strawberry Elephant" && n !== "Meowl");
            t = { name: list[Math.floor(Math.random()*list.length)], hp: 140, ico: "ðŸ§ ", d: 0, boss: false };
        }
        this.s.queue.push(t);
        this.log(`Threat Detected: ${t.name}`);
    },

    act: function(type) {
        if(type === 'fight') { if(this.s.queue.length > 0) this.openFight(); return; }
        if(this.s.ap <= 0) return;

        if(type === 'eat') this.s.eat = Math.min(100, this.s.eat + 45);
        if(type === 'study') this.s.kn = Math.min(500, this.s.kn + 60);
        if(type === 'gear') this.s.gr = Math.min(100, this.s.gr + 40);

        this.s.ap--;
        this.sync();
    },

    openFight: function() {
        const t = this.s.queue[0];
        this.s.combat = true;
        this.c = { eHP: t.hp, eMax: t.hp, pHP: 100 };
        document.getElementById('fight-screen').style.display = 'flex';
        document.getElementById('f-e-name').innerText = t.name;
        document.getElementById('f-head').innerText = t.boss ? "BOSS" : "CLASH";
        document.getElementById('f-log').innerHTML = "";
        this.syncF();
    },

    syncF: function() {
        document.getElementById('f-p-fill').style.width = this.c.pHP + "%";
        document.getElementById('f-e-fill').style.width = (this.c.eHP/this.c.eMax*100) + "%";
    },

    strike: function(m) {
        let res = Math.random() > 0.5 ? 45 : 20;
        this.c.eHP -= res;
        const d = 22 * (1 - (this.s.gr/250));
        this.c.pHP -= d; this.s.hp -= (d/4);

        const log = document.getElementById('f-log');
        log.innerHTML = `<div>> ${m}: ${res} DMG. Took ${Math.floor(d)} damage.</div>` + log.innerHTML;
        
        this.syncF();
        this.sync();

        if(this.c.eHP <= 0) {
            const v = this.s.queue.shift();
            this.record(v.name);
            this.s.combat = false;
            document.getElementById('fight-screen').style.display = 'none';
            this.log(`Purged: ${v.name}`);
        }
    },

    record: function(n) {
        let h = JSON.parse(localStorage.getItem('br_v90') || "[]");
        if(!h.includes(n)) h.push(n);
        localStorage.setItem('br_v90', JSON.stringify(h));
    },

    openIndex: function(show) {
        if(show) {
            document.body.style.overflow = "hidden";
            const k = JSON.parse(localStorage.getItem('br_v90') || "[]");
            const y = document.getElementById('idx-win'), n = document.getElementById('idx-loss');
            y.innerHTML = ""; n.innerHTML = "";
            this.master.forEach(r => {
                if(k.includes(r)) y.innerHTML += `<div class="name-row unlocked">${r}</div>`;
                else n.innerHTML += `<div class="name-row">${r}</div>`;
            });
            document.getElementById('index-screen').style.display = 'flex';
        } else {
            document.body.style.overflow = "auto";
            document.getElementById('index-screen').style.display = 'none';
        }
    },

    log: function(m) {
        const l = document.getElementById('system-log');
        l.innerHTML = `<div class="log-entry">${m}</div>` + l.innerHTML;
    }
};

window.onload = () => {
    const k = JSON.parse(localStorage.getItem('br_v90') || "[]");
    document.getElementById('legacy-msg').innerText = `SYSTEM RECORDS: ${k.length} / ${Game.master.length} PURGED`;
};
</script>
</body>
</html>
