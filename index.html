<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>99 NIGHTS: ULTRA BRAINROT INDEX V50.0</title>
    <style>
        /* 99 NIGHTS: CORE KERNEL V50.0 
           STRICT LINE COUNT TARGET: 800+
           FEATURES: BOSS GRACE, 1.5% CHANCE, BRAINROT INDEX, GOLDEN VICTORY
        */
        @import url('https://fonts.googleapis.com/css2?family=Monoton&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            --neon-green: #00ff00;
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --gold: #ffd700;
            --blood-red: #ff0000;
            --dark-bg: #050505;
            --glitch-color: #00ff00;
        }

        body {
            background-color: #000;
            color: var(--neon-green);
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
            transition: filter 0.2s;
        }

        /* --- GLITCH ANIMATION --- */
        @keyframes glitch {
            0% { transform: translate(0); text-shadow: -2px 0 red, 2px 0 blue; }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); text-shadow: 2px 0 red, -2px 0 blue; }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .glitch-active {
            animation: glitch 0.15s infinite;
            filter: hue-rotate(90deg);
        }

        #game-frame {
            width: 95%;
            max-width: 1000px;
            background: var(--dark-bg);
            border: 5px solid var(--neon-green);
            padding: 30px;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.2);
            position: relative;
        }

        h1 {
            font-family: 'Monoton', cursive;
            color: var(--neon-blue);
            font-size: 4.5em;
            text-align: center;
            margin: 0;
            text-shadow: 0 0 20px var(--neon-blue);
        }

        .header-stats {
            display: flex;
            justify-content: space-between;
            font-family: 'Orbitron', sans-serif;
            border-bottom: 2px solid var(--neon-blue);
            padding: 10px 0;
            margin-bottom: 25px;
            font-size: 1.2em;
        }

        /* --- VISUAL ARENA --- */
        #visual-arena {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .view-box {
            background: #111;
            border: 2px solid var(--neon-green);
            height: 360px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .sprite { font-size: 110px; margin-bottom: 15px; transition: transform 0.2s; }
        .char-label { font-family: 'Press Start 2P'; font-size: 9px; color: #888; text-transform: uppercase; }

        .threat-tag {
            position: absolute;
            top: 15px;
            right: 15px;
            color: var(--neon-pink);
            font-family: 'Orbitron';
            font-weight: 900;
        }

        /* --- PROGRESSION BARS --- */
        .system-bar {
            width: 100%;
            height: 40px;
            background: #1a1a1a;
            border: 1px solid var(--neon-green);
            margin-bottom: 15px;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            width: 100%;
            transition: width 0.4s ease-in-out;
        }

        .hp-fill { background: linear-gradient(90deg, #700, #f00); }
        .eat-fill { background: linear-gradient(90deg, #740, #f90); }
        .kn-fill { background: linear-gradient(90deg, #007, #00f); }
        .gr-fill { background: linear-gradient(90deg, #070, #0f0); }

        .bar-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 40px;
            font-family: 'Orbitron';
            font-weight: 900;
            color: #fff;
            text-shadow: 2px 2px 2px #000;
            font-size: 0.9em;
        }

        /* --- LOGGING --- */
        #system-log {
            height: 140px;
            overflow-y: scroll;
            background: #000;
            border: 1px solid var(--neon-green);
            padding: 15px;
            font-size: 0.9em;
            margin-bottom: 25px;
        }

        .log-line { margin-bottom: 6px; border-left: 4px solid var(--neon-green); padding-left: 12px; }
        .log-boss { color: var(--gold); border-left-color: var(--gold); font-weight: bold; }

        /* --- CONTROLS --- */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        button {
            background: #001f00;
            color: var(--neon-green);
            border: 2px solid var(--neon-green);
            padding: 20px;
            font-family: 'Orbitron';
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
        }

        button:hover:not(:disabled) {
            background: var(--neon-green);
            color: #000;
            box-shadow: 0 0 20px var(--neon-green);
        }

        #idx-open-btn { grid-column: span 2; border-color: var(--gold); color: var(--gold); margin-top: 10px; }
        #next-night-trigger { grid-column: span 2; background: var(--neon-blue); color: #000; font-size: 1.2em; margin-top: 10px; }

        /* --- OVERLAY SYSTEMS --- */
        .screen-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98);
            z-index: 9000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px;
            box-sizing: border-box;
        }

        #victory-modal h2 {
            font-family: 'Monoton';
            font-size: 8em;
            color: var(--gold);
            text-shadow: 0 0 50px var(--gold);
            margin: 0;
        }

        /* --- INDEX VIEW --- */
        #index-view { overflow-y: auto; display: none; }
        .index-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; width: 100%; max-width: 900px; }
        .idx-sec h3 { font-family: 'Press Start 2P'; font-size: 12px; color: var(--neon-blue); border-bottom: 2px solid var(--neon-blue); padding-bottom: 10px; }
        .idx-list { text-align: left; line-height: 2; font-size: 0.95em; color: #555; }
        .idx-item-win { color: var(--gold); font-weight: bold; }

        /* --- BOSS ARENA --- */
        #boss-arena { background: radial-gradient(circle, #200 0%, #000 100%); border: 10px double var(--blood-red); }

    </style>
</head>
<body id="master-body">

<div id="game-frame">
    <h1>99 NIGHTS</h1>
    
    <div class="header-stats">
        <span>CORE_STATUS: <span id="glitch-text">STABLE</span></span>
        <span>NIGHT: <span id="val-n">0</span></span>
        <span>AP: <span id="val-ap">2</span></span>
    </div>

    <div id="visual-arena">
        <div class="view-box">
            <div class="sprite">ðŸ‘¤</div>
            <div class="char-label">UNIT_PRIME</div>
        </div>
        <div class="view-box" id="enemy-box">
            <div class="threat-tag" id="val-q">STK: 0</div>
            <div class="sprite" id="val-ico">?</div>
            <div class="char-label" id="val-name">SCANNING...</div>
            <div id="val-timer" style="margin-top:10px; font-size:10px; color:var(--neon-pink); font-family:'Press Start 2P';"></div>
        </div>
    </div>

    <div class="system-bar"><div class="bar-fill hp-fill" id="bar-hp"></div><div class="bar-text">HEALTH: <span id="txt-hp">100</span>%</div></div>
    <div class="system-bar"><div class="bar-fill eat-fill" id="bar-eat"></div><div class="bar-text">FOOD: <span id="txt-eat">100</span>%</div></div>
    <div class="system-bar"><div class="bar-fill kn-fill" id="bar-kn"></div><div class="bar-text">KNOWLEDGE: <span id="txt-kn">0</span> / 500</div></div>
    <div class="system-bar"><div class="bar-fill gr-fill" id="bar-gr"></div><div class="bar-text">GEAR: <span id="txt-gr">20</span>%</div></div>

    <div id="system-log"></div>

    <div class="control-grid" id="main-ui" style="display:none;">
        <button onclick="Kernel.cmd('fight')">ENGAGE</button>
        <button onclick="Kernel.cmd('eat')">EAT (1 AP)</button>
        <button onclick="Kernel.cmd('study')">STUDY (1 AP)</button>
        <button onclick="Kernel.cmd('gear')">REPAIR (1 AP)</button>
        <button id="next-night-trigger" onclick="Kernel.cycleNight()">ADVANCE TO NEXT NIGHT</button>
        <button id="idx-open-btn" onclick="Kernel.toggleIndex(true)">OPEN BRAINROT INDEX</button>
    </div>

    <div id="boss-arena" class="screen-overlay">
        <h2 id="combat-mode" style="font-family:'Monoton'; font-size:4em; color:var(--blood-red);">CLASH</h2>
        <div style="width: 100%; max-width: 700px; margin: 20px 0;">
            <div class="system-bar"><div class="bar-fill hp-fill" id="c-p-fill"></div><div class="bar-text">PLAYER</div></div>
            <div class="system-bar"><div class="bar-fill" id="c-e-fill" style="background:var(--blood-red);"></div><div class="bar-text" id="c-e-name">THREAT</div></div>
        </div>
        <div id="combat-log" style="height:150px; width:100%; max-width:700px; background:#000; border:1px solid var(--blood-red); padding:15px; color:#fff; overflow-y:auto; margin-bottom:20px; font-size:0.9em;"></div>
        <div class="control-grid" style="width: 100%; max-width: 700px;">
            <button onclick="Kernel.strike('PUNCH')">STRIKE</button>
            <button onclick="Kernel.strike('DODGE')">EVADE</button>
        </div>
    </div>

    <div id="index-view" class="screen-overlay">
        <h2 style="font-family:'Monoton'; color:var(--gold);">INDEX</h2>
        <div class="index-grid">
            <div class="idx-sec">
                <h3>DEFEATED BEFORE</h3>
                <div id="idx-win-list" class="idx-list"></div>
            </div>
            <div class="idx-sec">
                <h3>NEVER DEFEATED</h3>
                <div id="idx-loss-list" class="idx-list"></div>
            </div>
        </div>
        <button onclick="Kernel.toggleIndex(false)" style="margin-top:40px; border-color:var(--neon-blue); color:var(--neon-blue);">RETURN TO SYSTEM</button>
    </div>

    <div id="victory-modal" class="screen-overlay">
        <h2>VICTORY</h2>
        <p style="font-family:'Orbitron'; color:#fff; margin-bottom:40px;">THE 99 NIGHTS HAVE BEEN CONQUERED</p>
        <button onclick="location.reload()" style="width:300px; margin-bottom:15px;">KEEP PLAYING</button>
        <button onclick="location.href='https://coolestschool.com'" style="width:300px; border-color:var(--gold); color:var(--gold);">QUIT TO HOME</button>
    </div>

    <div id="intro-modal" class="screen-overlay" style="display:flex;">
        <h2 style="font-family:'Press Start 2P'; color:var(--neon-blue);">99 NIGHTS</h2>
        <p id="save-status" style="color:var(--gold); font-family:'Orbitron'; font-size:12px; margin-bottom:20px;"></p>
        <button onclick="Kernel.init()">BOOT SYSTEM</button>
    </div>

    <div id="death-modal" class="screen-overlay">
        <h2 style="color:red; font-family:'Press Start 2P';">TERMINATED</h2>
        <button onclick="location.reload()">RE-SYNC</button>
    </div>
</div>

<script>
/**
 * 99 NIGHTS KERNEL V50.0
 * FULL BRAINROT REGISTRY INTEGRATED
 */
const Kernel = {
    // BRAINROT MASTER DATABASE
    master: [
        "Noobini Pizzanini", "Lirili Larila", "Talpa Di Fero", "Pipi Kiwi", "Bandito Bobritto", 
        "Boneca Ambalabu", "Cacto Hipopotamo", "Ta Ta Ta Ta Sahur", "Brr Brr Patapim", 
        "Bananita Dolfinita", "Avocadini Antilopini", "Ti Ti Ti Sahur", "Chimpanzini Bananini", 
        "Cocosini Mama", "Pipi Watermelon", "Chef Crabracadabra", "Tralalero Tralala", 
        "Tung Tung Tung Sahur", "Ballerina Cappuccina", "Orcalero Orcala", "Pakrahmatmamat", 
        "Elefanto Frigo", "Gorillone Subwoofero", "Dragon Cannelloni", "Spaghetti Tualetti", 
        "Agarrini La Palini", "Nuclearo Dinossauro", "Garama and Madundung", "Strawberry Elephant", "Meowl"
    ],

    // GAME STATE
    state: {
        n: 0, hp: 100, eat: 100, kn: 0, gr: 20, ap: 2,
        queue: [], active: false, combat: false, reward: false
    },

    init: function() {
        document.getElementById('intro-modal').style.display = 'none';
        document.getElementById('main-ui').style.display = 'grid';
        this.state.active = true;

        // Check for Night 15 Reward
        const savedDefeats = JSON.parse(localStorage.getItem('br_defeated') || "[]");
        if(this.master.every(val => savedDefeats.includes(val))) {
            this.state.n = 14;
            this.state.reward = true;
            this.log("LEGENDARY STATUS DETECTED: Night 15 Skip Unlocked.");
        }

        this.cycleNight();
        setInterval(() => this.backgroundTick(), 4500);
    },

    backgroundTick: function() {
        if(!this.state.active || this.state.combat) return;
        this.state.eat -= 0.7;
        this.state.gr -= 0.15;
        if(this.state.eat <= 0) { this.state.eat = 0; this.state.hp -= 1.8; }
        
        // Glitch Mechanic
        const body = document.getElementById('master-body');
        if(this.state.gr < 10) {
            body.classList.add('glitch-active');
            document.getElementById('glitch-text').innerText = "CORRUPTED";
        } else {
            body.classList.remove('glitch-active');
            document.getElementById('glitch-text').innerText = "STABLE";
        }
        
        this.updateUI();
    },

    updateUI: function() {
        document.getElementById('val-n').innerText = this.state.n;
        document.getElementById('val-ap').innerText = this.state.ap;
        document.getElementById('txt-hp').innerText = Math.floor(this.state.hp);
        document.getElementById('txt-eat').innerText = Math.floor(this.state.eat);
        document.getElementById('txt-kn').innerText = this.state.kn;
        document.getElementById('txt-gr').innerText = Math.floor(this.state.gr);

        document.getElementById('bar-hp').style.width = this.state.hp + "%";
        document.getElementById('bar-eat').style.width = this.state.eat + "%";
        document.getElementById('bar-kn').style.width = (this.state.kn/500*100) + "%";
        document.getElementById('bar-gr').style.width = this.state.gr + "%";

        document.getElementById('val-q').innerText = `STK: ${this.state.queue.length}`;
        
        if(this.state.queue.length > 0) {
            const current = this.state.queue[0];
            document.getElementById('val-name').innerText = current.name;
            document.getElementById('val-ico').innerText = current.ico;
            document.getElementById('val-timer').innerText = `LIMIT: ${4-current.d} NIGHTS`;
        } else {
            document.getElementById('val-name').innerText = "SEARCHING...";
            document.getElementById('val-ico').innerText = "âœ…";
            document.getElementById('val-timer').innerText = "";
        }

        if(this.state.hp <= 0) this.endGame();
        if(this.state.n >= 99 && !this.state.combat) document.getElementById('victory-modal').style.display = 'flex';
    },

    cycleNight: function() {
        this.state.n++;
        this.state.ap = 2;
        this.log(`Night ${this.state.n} synchronized. AP restored.`);

        let mustFight = false;
        this.state.queue.forEach(t => { 
            t.d++; 
            if(t.d >= 4) mustFight = true; 
        });

        this.generateThreat();
        if(mustFight) {
            this.log("CRITICAL: Queue overflow forced combat!", "log-boss");
            setTimeout(() => this.openCombat(), 800);
        }
        this.updateUI();
    },

    generateThreat: function() {
        const roll = Math.random() * 100;
        let t;

        // Boss logic (Night 7 Grace Period + 1.5% Chance)
        if (this.state.n > 7) {
            if (roll < 1.5) {
                t = { name: "Strawberry Elephant", hp: 880, ico: "ðŸ˜ðŸ“", d: 0, boss: true };
                this.log("ALERT: Strawberry Elephant signature detected!", "log-boss");
            } else if (roll < 3.0) {
                t = { name: "Meowl", hp: 550, ico: "ðŸ¦‰ðŸˆ", d: 0, boss: true };
                this.log("ALERT: Meowl blight contamination detected!", "log-boss");
            }
        }

        // Regular Brainrot
        if (!t) {
            const pool = this.master.filter(name => name !== "Strawberry Elephant" && name !== "Meowl");
            const randomName = pool[Math.floor(Math.random() * pool.length)];
            t = { name: randomName, hp: 135, ico: "ðŸ§ ", d: 0, boss: false };
        }
        
        this.state.queue.push(t);
    },

    cmd: function(action) {
        if(action === 'fight') {
            if(this.state.queue.length > 0) this.openCombat();
            return;
        }
        if(this.state.ap <= 0) return;

        if(action === 'eat') this.state.eat = Math.min(100, this.state.eat + 45);
        if(action === 'study') this.state.kn = Math.min(500, this.state.kn + 50);
        if(action === 'gear') this.state.gr = Math.min(100, this.state.gr + 40);

        this.state.ap--;
        this.updateUI();
    },

    openCombat: function() {
        const t = this.state.queue[0];
        this.state.combat = true;
        this.combatData = { eHP: t.hp, eMax: t.hp, pHP: 100 };
        
        document.getElementById('boss-arena').style.display = 'flex';
        document.getElementById('c-e-name').innerText = t.name;
        document.getElementById('combat-mode').innerText = t.boss ? "BOSS BATTLE" : "CLASH";
        document.getElementById('combat-log').innerHTML = "Establishing neural link to threat...";
        this.syncCombatUI();
    },

    syncCombatUI: function() {
        document.getElementById('c-p-fill').style.width = this.combatData.pHP + "%";
        document.getElementById('c-e-fill').style.width = (this.combatData.eHP / this.combatData.eMax * 100) + "%";
    },

    strike: function(move) {
        const enemyMove = Math.random() > 0.5 ? "PUNCH" : "DODGE";
        let outcome = "";
        const reduction = this.state.gr / 250;

        if(move === "PUNCH" && enemyMove === "PUNCH") {
            let pDmg = 25 * (1 - reduction);
            this.combatData.eHP -= 45;
            this.combatData.pHP -= pDmg;
            this.state.hp -= (pDmg / 4);
            outcome = `Direct exchange! You took ${Math.floor(pDmg)} damage.`;
        } else if(move === "PUNCH" && enemyMove === "DODGE") {
            if(Math.random() > 0.75) { this.combatData.eHP -= 110; outcome = "CRITICAL COUNTER!"; }
            else outcome = "Enemy evaded successfully.";
        } else if(move === "DODGE") {
            this.combatData.eHP -= 15;
            outcome = "You safely maneuvered and landed a light jab.";
        } else {
            this.combatData.eHP -= 30;
            outcome = "You caught the enemy off guard.";
        }

        const log = document.getElementById('combat-log');
        log.innerHTML = `<div>> ${outcome}</div>` + log.innerHTML;
        this.syncCombatUI();
        this.updateUI();

        if(this.combatData.eHP <= 0) {
            const defeated = this.state.queue.shift();
            this.saveDefeat(defeated.name);
            this.state.combat = false;
            document.getElementById('boss-arena').style.display = 'none';
            this.log(`Victory: ${defeated.name} has been purged.`);
        }
    },

    saveDefeat: function(name) {
        let history = JSON.parse(localStorage.getItem('br_defeated') || "[]");
        if(!history.includes(name)) history.push(name);
        localStorage.setItem('br_defeated', JSON.stringify(history));
    },

    toggleIndex: function(show) {
        if(show) {
            const wins = JSON.parse(localStorage.getItem('br_defeated') || "[]");
            const winDiv = document.getElementById('idx-win-list');
            const lossDiv = document.getElementById('idx-loss-list');
            winDiv.innerHTML = ""; lossDiv.innerHTML = "";
            
            this.master.forEach(name => {
                if(wins.includes(name)) winDiv.innerHTML += `<div class="idx-item-win">${name}</div>`;
                else lossDiv.innerHTML += `<div>${name}</div>`;
            });
            document.getElementById('index-view').style.display = 'flex';
        } else {
            document.getElementById('index-view').style.display = 'none';
        }
    },

    log: function(msg, cls="") {
        const logger = document.getElementById('system-log');
        logger.innerHTML = `<div class="log-line ${cls}">[SYSTEM] ${msg}</div>` + logger.innerHTML;
    },

    endGame: function() {
        this.state.active = false;
        document.getElementById('death-modal').style.display = 'flex';
    }
};

// Initial Database Check for Intro Text
window.onload = () => {
    const wins = JSON.parse(localStorage.getItem('br_defeated') || "[]");
    document.getElementById('save-status').innerText = `RECORDS FOUND: ${wins.length} / ${Kernel.master.length}`;
};
</script>
</body>
</html>
