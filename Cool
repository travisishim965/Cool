<!DOCTYPE html>
<html>
<head>
Â  Â  <title>99 Nights: Character View Simulator V12.6 (Easier Combat & Rescue)</title>
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Monoton&display=swap' (https://fonts.googleapis.com/css2?family=Monoton&display=swap%27));
Â  Â  Â  Â  
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Courier New', monospace;
Â  Â  Â  Â  Â  Â  background-color: #000000;
Â  Â  Â  Â  Â  Â  color: #00ff00;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  overflow-x: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  #game-container {
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  max-width: 900px;
Â  Â  Â  Â  Â  Â  background-color: #0d0d0d;
Â  Â  Â  Â  Â  Â  border: 4px solid #00ff00;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 0;
Â  Â  Â  Â  Â  Â  position: relative; 
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  color: #00ffff;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 5px #00ff00;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* --- PROGRESS BARS --- */
Â  Â  Â  Â  .progress-bar {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  background-color: #333;
Â  Â  Â  Â  Â  Â  border: 1px solid #00ff00;
Â  Â  Â  Â  Â  Â  margin: 5px 0;
Â  Â  Â  Â  Â  Â  height: 25px; 
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  line-height: 25px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* Adjustments for Knowledge and Hunger (smaller) */
Â  Â  Â  Â  #knowledge-bar, #hunger-bar {
Â  Â  Â  Â  Â  Â  Â height: 15px; 
Â  Â  Â  Â  Â  Â  Â line-height: 15px; 
Â  Â  Â  Â  Â  Â  Â font-size: 0.8em;
Â  Â  Â  Â  Â  Â  Â margin-bottom: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #knowledge-bar { border-color: #0099ff; }
Â  Â  Â  Â  
Â  Â  Â  Â  .progress-fill {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  transition: width 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #hunger-bar .progress-fill { background-color: #ffa500; } 
Â  Â  Â  Â  #health-bar .progress-fill { background-color: #ff0000; } 
Â  Â  Â  Â  #knowledge-bar .progress-fill { background-color: #0099ff; }
Â  Â  Â  Â  .progress-label {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 1;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- CHARACTER DISPLAY AREA --- */
Â  Â  Â  Â  #visual-scene {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-around;
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  border: 2px solid #00ffff;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  background-color: #050505;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .character-box {
Â  Â  Â  Â  Â  Â  width: 45%;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid #00ff00;
Â  Â  Â  Â  Â  Â  background-color: #1a1a1a;
Â  Â  Â  Â  Â  Â  height: 250px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  #player-icon { 
Â  Â  Â  Â  Â  Â  font-size: 80px;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  height: 100px;
Â  Â  Â  Â  Â  Â  line-height: 100px;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  #threat-icon {
Â  Â  Â  Â  Â  Â  font-family: 'Monoton', sans-serif;
Â  Â  Â  Â  Â  Â  font-size: 24px; 
Â  Â  Â  Â  Â  Â  color: #00ff99;
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 10px #00ff99;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  height: 100px;
Â  Â  Â  Â  Â  Â  line-height: 100px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .threat-details {
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  color: #ff88ff;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* --- END CHARACTER DISPLAY AREA --- */

Â  Â  Â  Â  /* --- DELETED: #stats-panel --- */
Â  Â  Â  Â  
Â  Â  Â  Â  #log {
Â  Â  Â  Â  Â  Â  height: auto; 
Â  Â  Â  Â  Â  Â  max-height: 200px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  border: 1px solid #00ff00;
Â  Â  Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  #actions {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  #actions button {
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  margin: 5px;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  background-color: #004400;
Â  Â  Â  Â  Â  Â  color: #00ff00;
Â  Â  Â  Â  Â  Â  border: 1px solid #00ff00;
Â  Â  Â  Â  Â  Â  border-radius: 0;
Â  Â  Â  Â  Â  Â  width: 180px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #action-buttons {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  padding: 10px 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* --- FIGHT SCREEN OVERLAY --- */
Â  Â  Â  Â  #fight-screen {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.95);
Â  Â  Â  Â  Â  Â  color: #ffff00;
Â  Â  Â  Â  Â  Â  display: none; 
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #fight-log {
Â  Â  Â  Â  Â  Â  height: 150px;
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  border: 1px solid #ff00ff;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  background-color: #1a001a;
Â  Â  Â  Â  }
Â  Â  Â  Â  #fight-stats {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-around;
Â  Â  Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #fight-controls {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  #fight-controls button {
Â  Â  Â  Â  Â  Â  background-color: #990099;
Â  Â  Â  Â  Â  Â  color: #ffff00;
Â  Â  Â  Â  Â  Â  border-color: #ff00ff;
Â  Â  Â  Â  Â  Â  width: 150px;
Â  Â  Â  Â  Â  Â  margin: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .fight-bar-container {
Â  Â  Â  Â  Â  Â  width: 45%;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .fight-bar {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  background-color: #333;
Â  Â  Â  Â  Â  Â  border: 1px solid #ff0000;
Â  Â  Â  Â  Â  Â  margin: 5px 0;
Â  Â  Â  Â  Â  Â  height: 15px;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }
Â  Â  Â  Â  .fight-fill {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  transition: width 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  #fight-player-bar .fight-fill { background-color: #00ff00; }
Â  Â  Â  Â  #fight-threat-bar .fight-fill { background-color: #ff0000; }

Â  Â  Â  Â  /* --- GLOBAL OVERLAYS (TUTORIALS) --- */
Â  Â  Â  Â  .overlay {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.99);
Â  Â  Â  Â  Â  Â  color: #00ffff;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  z-index: 20;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .overlay h2 { color: #ffff00; }
Â  Â  Â  Â  .overlay button {
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  background-color: #004444;
Â  Â  Â  Â  Â  Â  color: #00ffff;
Â  Â  Â  Â  Â  Â  border: 1px solid #00ffff;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .overlay #tutorial-actions button {
Â  Â  Â  Â  Â  Â  background-color: #006600;
Â  Â  Â  Â  Â  Â  color: #00ff00;
Â  Â  Â  Â  }


Â  Â  Â  Â  .message-success { color: #00ff00; }
Â  Â  Â  Â  .message-fail { color: #ff0000; }
Â  Â  Â  Â  .message-event { color: #ffff00; }
Â  Â  Â  Â  .message-critical { color: #ff0000; font-weight: bold; }
Â  Â  Â  Â  .message-hint { color: #00ffff; font-style: italic;}
Â  Â  </style>
</head>
<body>

Â  Â  <div id="game-container">
Â  Â  Â  Â  <h1>[99Nights] CHARACTER VIEW SIMULATOR V12.6</h1>
Â  Â  Â  Â  <p style="text-align: center; color: #00ffff;">Action Points: <span id="ap-stat">0</span> | Night: <span id="night-counter">1</span> / 99</p>

Â  Â  Â  Â  <div id="visual-scene">
Â  Â  Â  Â  Â  Â  <div id="player-view" class="character-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="player-icon">ðŸ‘¤</div> 
Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="player-name-display">Awaiting Initialization...</h3> 
Â  Â  Â  Â  Â  Â  Â  Â  <p>Equipped: Gear (<span id="durability-stat-icon">100</span>%)</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="threat-view" class="character-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="threat-icon">TEAM BRAINROT</div> 
Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="threat-name-display">Awaiting Encounter...</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="threat-details" id="threat-state-display">---</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="health-bar" class="progress-bar">
Â  Â  Â  Â  Â  Â  <div id="health-fill" class="progress-fill"></div>
Â  Â  Â  Â  Â  Â  <span id="health-label" class="progress-label">HEALTH: 100%</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div id="knowledge-bar" class="progress-bar">
Â  Â  Â  Â  Â  Â  <div id="knowledge-fill" class="progress-fill"></div>
Â  Â  Â  Â  Â  Â  <span id="knowledge-label" class="progress-label">KNOWLEDGE: 0 / 500</span>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="hunger-bar" class="progress-bar">
Â  Â  Â  Â  Â  Â  <div id="hunger-fill" class="progress-fill"></div>
Â  Â  Â  Â  Â  Â  <span id="hunger-label" class="progress-label">HUNGER: 100%</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div id="log">
Â  Â  Â  Â  Â  Â  <p class="message-event">System Initialized. Click START to generate your Brainrot identity.</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="actions">
Â  Â  Â  Â  Â  Â  <button id="startButton" onclick="startGame()">START ENCOUNTER</button>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div id="action-buttons" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <div id="fight-screen">
Â  Â  Â  Â  Â  Â  <h2>ðŸ§  BRAINROT COMBAT ENGAGED ðŸ§ </h2>
Â  Â  Â  Â  Â  Â  <div id="fight-stats">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="fight-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Player HP: <span id="fight-player-hp">100</span>%
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="fight-player-bar" class="fight-bar"><div id="fight-player-fill" class="fight-fill"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="fight-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Brainrot HP: <span id="fight-threat-hp">100</span>%
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="fight-threat-bar" class="fight-bar"><div id="fight-threat-fill" class="fight-fill"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="fight-log">
Â  Â  Â  Â  Â  Â  Â  Â  <p>The **<span id="fight-threat-name"></span>** lunges!</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="fight-controls">
Â  Â  Â  Â  Â  Â  Â  Â  <p id="fight-prompt">---</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display: flex;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="fightAction('PUNCH')">PUNCH ðŸ‘Š</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="fightAction('DODGE')">DODGE ðŸ¤¸</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="pregame-tutorial" class="overlay">
Â  Â  Â  Â  Â  Â  <h2>START-UP TUTORIAL</h2>
Â  Â  Â  Â  Â  Â  <p id="tutorial-step-text">Would you like a brief, interactive tutorial on core game actions (Study, Eat, Fight) before starting Night 1?</p>
Â  Â  Â  Â  Â  Â  <div id="tutorial-actions">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="startTutorial()">YES, GUIDE ME</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="skipTutorial()">NO, START GAME</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="combat-tutorial" class="overlay" style="display: none;">
Â  Â  Â  Â  Â  Â  <h2>COMBAT TUTORIAL: THE BRAINROT CYCLE</h2>
Â  Â  Â  Â  Â  Â  <p>Welcome to the tactical Brainrot combat system. To defeat the Brainrot, you must correctly predict its move.</p>
Â  Â  Â  Â  Â  Â  <br>
Â  Â  Â  Â  Â  Â  <p>1. **IF IT PUNCHES:** You must choose **DODGE** to completely avoid damage. Choosing PUNCH results in heavy damage to you.</p>
Â  Â  Â  Â  Â  Â  <p>2. **IF IT DODGES:** You must choose **PUNCH** to inflict minor damage. Choosing DODGE results in a stalemate (minor self-fatigue).</p>
Â  Â  Â  Â  Â  Â  <p>The **Knowledge Hint** ability can sometimes help you guess the Brainrot's intent before combat!</p>
Â  Â  Â  Â  Â  Â  <button onclick="exitCombatTutorial()">RESUME FIGHT</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // --- CONSTANTS ---
Â  Â  Â  Â  const NIGHTS_TO_SURVIVE = 99;
Â  Â  Â  Â  const GEAR_DRAIN_PER_NIGHT = 5;
Â  Â  Â  Â  const HUNGER_DRAIN_PER_NIGHT = 10;
Â  Â  Â  Â  const MAX_KNOWLEDGE = 500; 
Â  Â  Â  Â  
Â  Â  Â  Â  // KNOWLEDGE/AP GAIN CONSTANTS
Â  Â  Â  Â  const STUDY_KNOWLEDGE_GAIN = 10; 
Â  Â  Â  Â  const FIGHT_AP_REWARD = 1; 
Â  Â  Â  Â  const HEALTH_ESCALATION_MULTIPLIER = 1.5; 
Â  Â  Â  Â  const FORCE_COMBAT_AFTER_NIGHTS = 3; // Threat forces combat on the night AFTER this many nights (i.e., on Night 4 if unresolved)
Â  Â  Â  Â  
Â  Â  Â  Â  const ANIMAL_PARTS_MAP = {
Â  Â  Â  Â  Â  Â  'Cat': 'ðŸˆ', 'Dog': 'ðŸ•â€', 'Capybara': 'ðŸ¦¦', 
Â  Â  Â  Â  Â  Â  'Nutria': 'ðŸ¦«', 'Seagull': 'âš¡', 'Rabbit': 'ðŸ‡', 
Â  Â  Â  Â  Â  Â  'Fox': 'ðŸ¦Š', 'Otter': 'ðŸ¦¦'
Â  Â  Â  Â  };
Â  Â  Â  Â  const ANIMAL_NAMES = Object.keys(ANIMAL_PARTS_MAP);

Â  Â  Â  Â  // --- THREAT DATA ---
Â  Â  Â  Â  const THREAT_DATA = [
Â  Â  Â  Â  Â  Â  { name: "tralalero Tralala", state: { ideal_action: "Fight", non_ideal: "Escape" } },
Â  Â  Â  Â  Â  Â  { name: "Travcitos", state: { ideal_action: "Escape", non_ideal: "Fight" } },
Â  Â  Â  Â  Â  Â  { name: "tung tung tung sahur", state: { ideal_action: "Eat", non_ideal: "Study" } },
Â  Â  Â  Â  Â  Â  { name: "Ballerina Cappucina", state: { ideal_action: "Study", non_ideal: "Eat" } },
Â  Â  Â  Â  Â  Â  { name: "Brr Brr Patapim", state: { ideal_action: "Fight", non_ideal: "Eat" } },
Â  Â  Â  Â  Â  Â  { name: "Lirili Larila", state: { ideal_action: "Escape", non_ideal: "Study" } },
Â  Â  Â  Â  Â  Â  { name: "Odin Din Din Dun", state: { ideal_action: "Study", non_ideal: "Fight" } },
Â  Â  Â  Â  Â  Â  { name: "Dragon Canneloni", state: { ideal_action: "Eat", non_ideal: "Escape" } },
Â  Â  Â  Â  ];
Â  Â  Â  Â  
Â  Â  Â  Â  // --- ACTION DEFINITIONS ---
Â  Â  Â  Â  const ACTION_MATRIX = {
Â  Â  Â  Â  Â  Â  "Fight": { ap_cost: 0, desc: "Enter tactical combat screen against the **oldest** Brainrot.", type: "combat" }, 
Â  Â  Â  Â  Â  Â  "Escape": { ap_cost: 1, h: -10, d: -5, type: "utility" }, 
Â  Â  Â  Â  Â  Â  "Eat": { ap_cost: 1, h: 0, hng_gain: 40, type: "utility" }, 
Â  Â  Â  Â  Â  Â  "Study": { ap_cost: 1, h: -5, k_gain: STUDY_KNOWLEDGE_GAIN, type: "utility" }, 
Â  Â  Â  Â  Â  Â  "Maintain Gear": { ap_cost: 1, h: -10, d_gain: 50, type: "utility" }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- GAME STATE ---
Â  Â  Â  Â  let gameState = {
Â  Â  Â  Â  Â  Â  night: 0, // Set to 0 so the first advanceNight sets it to 1
Â  Â  Â  Â  Â  Â  health: 100, durability: 100, hunger: 100,
Â  Â  Â  Â  Â  Â  actionPoints: 0, 
Â  Â  Â  Â  Â  Â  knowledge: 0, 
Â  Â  Â  Â  Â  Â  modifiers: { DRD: 1.00, EFF: 1.00, FTG: 1.00 },
Â  Â  Â  Â  Â  Â  project: { name: null, remaining: 0, discipline: null, base_cost: 0 }, 
Â  Â  Â  Â  Â  Â  escapedBrainrots: [],
Â  Â  Â  Â  Â  Â  isRunning: false,
Â  Â  Â  Â  Â  Â  activeThreats: [], // Array of { name: '...', state: {...}, baseHP: 100, daysPersistent: 1, currentThreatState: "Agitated" }
Â  Â  Â  Â  Â  Â  currentThreatState: "Agitated", // This now reflects the oldest threat's state
Â  Â  Â  Â  Â  Â  playerName: "Awaiting Generation",
Â  Â  Â  Â  Â  Â  playerIcon: "ðŸ‘¤",
Â  Â  Â  Â  Â  Â  tutorialStep: 0, 
Â  Â  Â  Â  Â  Â  tutorialViewed: false, 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Fight state
Â  Â  Â  Â  Â  Â  fightState: {
Â  Â  Â  Â  Â  Â  Â  Â  inProgress: false,
Â  Â  Â  Â  Â  Â  Â  Â  threatHP: 100, 
Â  Â  Â  Â  Â  Â  Â  Â  playerHP: 100,
Â  Â  Â  Â  Â  Â  Â  Â  threatNextMove: null, 
Â  Â  Â  Â  Â  Â  Â  Â  isTutorialFight: false, 
Â  Â  Â  Â  Â  Â  Â  Â  targetThreatIndex: -1, // Index of the threat being fought in activeThreats array
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- DOM REFERENCES ---
Â  Â  Â  Â  let D = {};

Â  Â  Â  Â  // --- UTILITY ---
Â  Â  Â  Â  function clamp(value) { return Math.max(0, Math.min(100, value)); }
Â  Â  Â  Â  function clampHunger(value) { return Math.max(0, Math.min(150, value)); } 
Â  Â  Â  Â  function getModifier(key) { return 1.0; } 
Â  Â  Â  Â  
Â  Â  Â  Â  function appendLog(message, className = 'message-event') {
Â  Â  Â  Â  Â  Â  if (!D.logDiv) return;
Â  Â  Â  Â  Â  Â  const p = document.createElement('p');
Â  Â  Â  Â  Â  Â  p.className = className;
Â  Â  Â  Â  Â  Â  // Only add Night prefix if not in the tutorial phase
Â  Â  Â  Â  Â  Â  const prefix = gameState.tutorialStep > 0 ? "[TUTORIAL]" : `[NIGHT ${gameState.night}]`;
Â  Â  Â  Â  Â  Â  p.innerHTML = `${prefix} ${message}`;
Â  Â  Â  Â  Â  Â  D.logDiv.appendChild(p);
Â  Â  Â  Â  Â  Â  D.logDiv.scrollTop = D.logDiv.scrollHeight; 
Â  Â  Â  Â  }

Â  Â  Â  Â  function determineHintChance() {
Â  Â  Â  Â  Â  Â  const knowledge = gameState.knowledge;
Â  Â  Â  Â  Â  Â  let chance = 5; 

Â  Â  Â  Â  Â  Â  if (knowledge >= 500) chance = 65;
Â  Â  Â  Â  Â  Â  else if (knowledge >= 400) chance = 45;
Â  Â  Â  Â  Â  Â  else if (knowledge >= 300) chance = 35;
Â  Â  Â  Â  Â  Â  else if (knowledge >= 200) chance = 25;
Â  Â  Â  Â  Â  Â  else if (knowledge >= 75) chance = 15;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return Math.min(Math.max(chance, 5), 65); 
Â  Â  Â  Â  }

Â  Â  Â  Â  function checkAndApplyHint() {
Â  Â  Â  Â  Â  Â  const chance = determineHintChance();
Â  Â  Â  Â  Â  Â  if (gameState.activeThreats.length > 0 && Math.random() * 100 < chance) {
Â  Â  Â  Â  Â  Â  Â  Â  // Hint applies to the oldest threat (index 0)
Â  Â  Â  Â  Â  Â  Â  Â  const threat = gameState.activeThreats[0];
Â  Â  Â  Â  Â  Â  Â  Â  const optimal = threat.currentThreatState === 'Agitated' ? threat.state.ideal_action : threat.state.non_ideal;
Â  Â  Â  Â  Â  Â  Â  Â  appendLog(`[ðŸ§  KNOWLEDGE HINT] Your insight (${chance.toFixed(1)}% chance) suggests the best approach for **${threat.name (http://threat.name/)}** is **${optimal}**.`, 'message-hint');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function generateAnimalCobosName() {
Â  Â  Â  Â  Â  Â  let part1 = ANIMAL_NAMES[Math.floor(Math.random() * ANIMAL_NAMES.length)];
Â  Â  Â  Â  Â  Â  let part2 = ANIMAL_NAMES[Math.floor(Math.random() * ANIMAL_NAMES.length)];
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  while (part1 === part2) {
Â  Â  Â  Â  Â  Â  Â  Â  part2 = ANIMAL_NAMES[Math.floor(Math.random() * ANIMAL_NAMES.length)];
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const iconKey = Math.random() < 0.5 ? part1 : part2;
Â  Â  Â  Â  Â  Â  gameState.playerIcon = ANIMAL_PARTS_MAP[iconKey];

Â  Â  Â  Â  Â  Â  return `${part1}-${part2}`;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function applyActionCost(baseValue) {
Â  Â  Â  Â  Â  Â  return Math.round(baseValue);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function applyActionReward(baseValue) {
Â  Â  Â  Â  Â  Â  return Math.round(baseValue);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  function determineThreatState(threatName) {
Â  Â  Â  Â  Â  Â  // Use the single knowledge score for the check
Â  Â  Â  Â  Â  Â  const knowledgeScore = gameState.knowledge;
Â  Â  Â  Â  Â  Â  if (Math.random() * 100 < knowledgeScore) {
Â  Â  Â  Â  Â  Â  Â  Â  return "Lethargic"; 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  return "Agitated"; 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // --- STAT AND DISPLAY UPDATE FUNCTIONS ---

Â  Â  Â  Â  function updateStatsDisplay() {
Â  Â  Â  Â  Â  Â  if (!D.nightCounter) return;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const knowledge = gameState.knowledge;
Â  Â  Â  Â  Â  Â  const knowledgePercent = (knowledge / MAX_KNOWLEDGE) * 100;

Â  Â  Â  Â  Â  Â  D.playerNameDisplay.textContent = gameState.playerName.toUpperCase();
Â  Â  Â  Â  Â  Â  D.playerIcon.textContent = gameState.playerIcon; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  D.nightCounter.textContent = gameState.night;
Â  Â  Â  Â  Â  Â  D.durabilityStatIcon.textContent = clamp(gameState.durability);
Â  Â  Â  Â  Â  Â  D.apStat.textContent = gameState.actionPoints;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Health Bar Update (Main)
Â  Â  Â  Â  Â  Â  D.healthFill.style.width = `${clamp(gameState.health)}%`;
Â  Â  Â  Â  Â  Â  D.healthLabel.textContent = `HEALTH: ${gameState.health.toFixed(0)}%`;
Â  Â  Â  Â  Â  Â  D.healthFill.style.backgroundColor = gameState.health > 50 ? '#00ff00' : (gameState.health > 20 ? '#ffff00' : '#ff0000');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Knowledge Bar Update
Â  Â  Â  Â  Â  Â  D.knowledgeFill.style.width = `${clamp(knowledgePercent)}%`;
Â  Â  Â  Â  Â  Â  D.knowledgeLabel.textContent = `KNOWLEDGE: ${knowledge} / ${MAX_KNOWLEDGE}`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Hunger Bar Update
Â  Â  Â  Â  Â  Â  D.hungerFill.style.width = `${clamp(gameState.hunger)}%`;
Â  Â  Â  Â  Â  Â  D.hungerLabel.textContent = `HUNGER: ${gameState.hunger.toFixed(0)}%`;
Â  Â  Â  Â  Â  Â  D.hungerFill.style.backgroundColor = gameState.hunger > 50 ? '#ffa500' : (gameState.hunger > 20 ? '#ff8800' : '#ff0000');
Â  Â  Â  Â  Â  Â  D.hungerLabel.style.color = gameState.hunger > 20 ? '#000' : '#ff0000'; 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (gameState.activeThreats.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const oldestThreat = gameState.activeThreats[0];
Â  Â  Â  Â  Â  Â  Â  Â  const threatCount = gameState.activeThreats.length;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  let summary = oldestThreat.name.toUpperCase();
Â  Â  Â  Â  Â  Â  Â  Â  if (threatCount > 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  summary += ` (+${threatCount - 1} more)`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  D.threatNameDisplay.textContent = summary;
Â  Â  Â  Â  Â  Â  Â  Â  // Calculate nights remaining (must be greater than 0)
Â  Â  Â  Â  Â  Â  Â  Â  const nightsRemaining = FORCE_COMBAT_AFTER_NIGHTS - oldestThreat.daysPersistent + 1;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  D.threatStateDisplay.textContent = `Presents for ${oldestThreat.daysPersistent} Day(s). Attack in: ${Math.max(0, nightsRemaining)} Nights. (Health: ${oldestThreat.baseHP.toFixed(0)}%)`;
Â  Â  Â  Â  Â  Â  Â  Â  D.threatView.style.borderColor = oldestThreat.daysPersistent >= FORCE_COMBAT_AFTER_NIGHTS ? '#ff0000' : '#00ffff';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â D.threatNameDisplay.textContent = 'NO ACTIVE THREATS';
Â  Â  Â  Â  Â  Â  Â  Â  Â D.threatStateDisplay.textContent = `AP: ${gameState.actionPoints}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â D.threatView.style.borderColor = '#00ff00';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // --- GAME LOOP INITIATORS ---

Â  Â  Â  Â  function initializeDOMElements() {
Â  Â  Â  Â  Â  Â  D.gameContainer = document.getElementById('game-container');
Â  Â  Â  Â  Â  Â  D.nightCounter = document.getElementById('night-counter');
Â  Â  Â  Â  Â  Â  D.durabilityStatIcon = document.getElementById('durability-stat-icon');
Â  Â  Â  Â  Â  Â  D.apStat = document.getElementById('ap-stat');
Â  Â  Â  Â  Â  Â  D.healthFill = document.getElementById('health-fill');
Â  Â  Â  Â  Â  Â  D.healthLabel = document.getElementById('health-label');
Â  Â  Â  Â  Â  Â  D.knowledgeFill = document.getElementById('knowledge-fill');
Â  Â  Â  Â  Â  Â  D.knowledgeLabel = document.getElementById('knowledge-label');
Â  Â  Â  Â  Â  Â  D.hungerFill = document.getElementById('hunger-fill');
Â  Â  Â  Â  Â  Â  D.hungerLabel = document.getElementById('hunger-label');
Â  Â  Â  Â  Â  Â  D.logDiv = document.getElementById('log');
Â  Â  Â  Â  Â  Â  D.startButton = document.getElementById('startButton');
Â  Â  Â  Â  Â  Â  D.actionButtonsDiv = document.getElementById('action-buttons');
Â  Â  Â  Â  Â  Â  D.playerIcon = document.getElementById('player-icon');
Â  Â  Â  Â  Â  Â  D.playerNameDisplay = document.getElementById('player-name-display');
Â  Â  Â  Â  Â  Â  D.threatNameDisplay = document.getElementById('threat-name-display');
Â  Â  Â  Â  Â  Â  D.threatStateDisplay = document.getElementById('threat-state-display');
Â  Â  Â  Â  Â  Â  D.threatView = document.getElementById('threat-view');
Â  Â  Â  Â  Â  Â  D.pregameTutorial = document.getElementById('pregame-tutorial');
Â  Â  Â  Â  }

Â  Â  Â  Â  window.startGame = function() {
Â  Â  Â  Â  Â  Â  if (gameState.isRunning) return;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  initializeDOMElements(); 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const generatedName = generateAnimalCobosName();

Â  Â  Â  Â  Â  Â  // Reset Game State
Â  Â  Â  Â  Â  Â  gameState = {
Â  Â  Â  Â  Â  Â  Â  Â  night: 0, // Set to 0 so the first advanceNight sets it to 1
Â  Â  Â  Â  Â  Â  Â  Â  health: 100, durability: 100, hunger: 100,
Â  Â  Â  Â  Â  Â  Â  Â  actionPoints: 0, 
Â  Â  Â  Â  Â  Â  Â  Â  knowledge: 0, 
Â  Â  Â  Â  Â  Â  Â  Â  modifiers: { DRD: 1.00, EFF: 1.00, FTG: 1.00 },
Â  Â  Â  Â  Â  Â  Â  Â  project: { name: null, remaining: 0, discipline: null, base_cost: 0 }, 
Â  Â  Â  Â  Â  Â  Â  Â  escapedBrainrots: [],
Â  Â  Â  Â  Â  Â  Â  Â  isRunning: true,
Â  Â  Â  Â  Â  Â  Â  Â  activeThreats: [], 
Â  Â  Â  Â  Â  Â  Â  Â  currentThreatState: "Agitated",
Â  Â  Â  Â  Â  Â  Â  Â  playerName: generatedName,
Â  Â  Â  Â  Â  Â  Â  Â  playerIcon: gameState.playerIcon,
Â  Â  Â  Â  Â  Â  Â  Â  tutorialStep: 0, 
Â  Â  Â  Â  Â  Â  Â  Â  tutorialViewed: false, 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  fightState: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inProgress: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  threatHP: 100,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerHP: 100,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  threatNextMove: null, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isTutorialFight: false, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  targetThreatIndex: -1, 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // Show tutorial prompt first
Â  Â  Â  Â  Â  Â  D.pregameTutorial.style.display = 'flex';
Â  Â  Â  Â  }

Â  Â  Â  Â  function createActionButton(actionName) {
Â  Â  Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  Â  Â  const action = ACTION_MATRIX[actionName];
Â  Â  Â  Â  Â  Â  button.textContent = `${actionName.toUpperCase()} (-${action.ap_cost} AP)`;
Â  Â  Â  Â  Â  Â  button.onclick = () => window.takeAction(actionName); 
Â  Â  Â  Â  Â  Â  button.id (http://button.id/) = `btn-${actionName.toLowerCase().replace(' ', '-')}`;
Â  Â  Â  Â  Â  Â  D.actionButtonsDiv.appendChild(button);
Â  Â  Â  Â  }

Â  Â  Â  Â  function initializeGameUI() {
Â  Â  Â  Â  Â  Â  D.startButton.style.display = 'none';
Â  Â  Â  Â  Â  Â  D.actionButtonsDiv.style.display = 'flex';
Â  Â  Â  Â  Â  Â  D.logDiv.innerHTML = '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Clear and render fixed action buttons
Â  Â  Â  Â  Â  Â  D.actionButtonsDiv.innerHTML = '';
Â  Â  Â  Â  Â  Â  Object.keys(ACTION_MATRIX).forEach(createActionButton);

Â  Â  Â  Â  Â  Â  appendLog(`Welcome, ${gameState.playerName}! You must survive 99 Nights.`, 'message-success');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Start the game loop properly by calling advanceNight, 
Â  Â  Â  Â  Â  Â  // which sets AP to 3 and spawns the first threat on Night 1.
Â  Â  Â  Â  Â  Â  window.advanceNight(); 
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- CORE GAME LOOP ---
Â  Â  Â  Â  // Made global for tutorial/initialization access
Â  Â  Â  Â  window.advanceNight = function() {
Â  Â  Â  Â  Â  Â  if (!gameState.isRunning && gameState.night > 0) return; // Allow the first call when night is 0

Â  Â  Â  Â  Â  Â  // 1. Advance Night Counter
Â  Â  Â  Â  Â  Â  gameState.night++;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // V12.6 RESCUE CONDITION
Â  Â  Â  Â  Â  Â  if (gameState.night > NIGHTS_TO_SURVIVE) {
Â  Â  Â  Â  Â  Â  Â  Â  endGame(true, "The 99th night has passed. A rescue helicopter arrives, pulling you from the noise!");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. Apply End-of-Night Status Effects (Only apply if this isn't the very first night)
Â  Â  Â  Â  Â  Â  if (gameState.night > 1) {
Â  Â  Â  Â  Â  Â  Â  Â  gameState.durability = clamp(gameState.durability - GEAR_DRAIN_PER_NIGHT);
Â  Â  Â  Â  Â  Â  Â  Â  gameState.hunger = clampHunger(gameState.hunger - HUNGER_DRAIN_PER_NIGHT);

Â  Â  Â  Â  Â  Â  Â  Â  // Health penalty for hunger
Â  Â  Â  Â  Â  Â  Â  Â  if (gameState.hunger <= 20) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const healthLoss = 5;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.health = clamp(gameState.health - healthLoss);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appendLog(`Extreme Hunger! You lose ${healthLoss} health.`, 'message-critical');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Health check
Â  Â  Â  Â  Â  Â  if (gameState.health <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  endGame(false, "Your health dropped to zero.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 3. Update Active Threats (Persistence and Escalation)
Â  Â  Â  Â  Â  Â  if (gameState.activeThreats.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  appendLog(`**${gameState.activeThreats.length} Brainrot(s) remain active.**`, 'message-event');
Â  Â  Â  Â  Â  Â  Â  Â  let forceFight = false;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  gameState.activeThreats.forEach((threat, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  threat.daysPersistent += 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (index === 0) { // Only escalate the oldest threat (index 0)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (threat.daysPersistent > 1) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  threat.baseHP = Math.round(threat.baseHP * HEALTH_ESCALATION_MULTIPLIER);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // NOTE: The display will show the escalated HP for combat purposes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appendLog(`The oldest threat, **${threat.name (http://threat.name/)}**, has accumulated strength (1.5x HP Multiplier)! Current estimated combat HP: ${threat.baseHP.toFixed(0)}%.`, 'message-critical');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Check for forced combat on the oldest threat
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (threat.daysPersistent > FORCE_COMBAT_AFTER_NIGHTS) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forceFight = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appendLog(`The **${threat.name (http://threat.name/)}** has persisted for too long! Combat is now **FORCED**!`, 'message-critical');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (forceFight) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Force the fight against the oldest, strongest threat
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enterFightScreen(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return; 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 4. Spawn New Threat (Always)
Â  Â  Â  Â  Â  Â  const newThreatData = THREAT_DATA[Math.floor(Math.random() * THREAT_DATA.length)];
Â  Â  Â  Â  Â  Â  const newThreat = {
Â  Â  Â  Â  Â  Â  Â  Â  ...newThreatData,
Â  Â  Â  Â  Â  Â  Â  Â  baseHP: 100, // Base health is always 100 at spawn
Â  Â  Â  Â  Â  Â  Â  Â  daysPersistent: 1,
Â  Â  Â  Â  Â  Â  Â  Â  currentThreatState: determineThreatState(newThreatData.name)
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  gameState.activeThreats.push(newThreat);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  appendLog(`A new Brainrot appears: **${newThreat.name}**! It seems to be ${newThreat.currentThreatState}.`, 'message-event');

Â  Â  Â  Â  Â  Â  // 5. Reset AP and Update Display
Â  Â  Â  Â  Â  Â  gameState.actionPoints = 3; // Standard AP refresh
Â  Â  Â  Â  Â  Â  updateStatsDisplay();
Â  Â  Â  Â  Â  Â  checkAndApplyHint();
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- ACTION HANDLERS ---
Â  Â  Â  Â  // Made global for button access
Â  Â  Â  Â  window.takeAction = function(actionName) {
Â  Â  Â  Â  Â  Â  if (!gameState.isRunning || gameState.fightState.inProgress || gameState.tutorialStep > 0) return;

Â  Â  Â  Â  Â  Â  const action = ACTION_MATRIX[actionName];
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (action.ap_cost > 0 && gameState.actionPoints < action.ap_cost) {
Â  Â  Â  Â  Â  Â  Â  Â  appendLog(`Not enough Action Points to ${actionName}. Requires ${action.ap_cost} AP.`, 'message-fail');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (actionName === "Fight") {
Â  Â  Â  Â  Â  Â  Â  Â  if (gameState.activeThreats.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  appendLog("No Brainrots currently present to fight.", 'message-fail');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  // Fight always targets the oldest threat (index 0)
Â  Â  Â  Â  Â  Â  Â  Â  enterFightScreen(0); 
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // General AP cost
Â  Â  Â  Â  Â  Â  if (action.ap_cost > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  gameState.actionPoints -= action.ap_cost;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Apply effects
Â  Â  Â  Â  Â  Â  gameState.health = clamp(gameState.health + (action.h || 0));
Â  Â  Â  Â  Â  Â  gameState.durability = clamp(gameState.durability + (action.d_gain || 0) + (action.d || 0));
Â  Â  Â  Â  Â  Â  gameState.hunger = clampHunger(gameState.hunger + (action.hng_gain || 0));

Â  Â  Â  Â  Â  Â  let message = `You chose to **${actionName}**.`;
Â  Â  Â  Â  Â  Â  let successClass = 'message-event';

Â  Â  Â  Â  Â  Â  if (actionName === "Study") {
Â  Â  Â  Â  Â  Â  Â  Â  const kGain = applyActionReward(action.k_gain);
Â  Â  Â  Â  Â  Â  Â  Â  gameState.knowledge = Math.min(gameState.knowledge + kGain, MAX_KNOWLEDGE);
Â  Â  Â  Â  Â  Â  Â  Â  message += ` Gained **${kGain} KNOWLEDGE**. Total: ${gameState.knowledge}`;
Â  Â  Â  Â  Â  Â  Â  Â  successClass = 'message-success';
Â  Â  Â  Â  Â  Â  } 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (actionName === "Maintain Gear") {
Â  Â  Â  Â  Â  Â  Â  Â  message += ` Gear repaired to ${gameState.durability.toFixed(0)}%.`;
Â  Â  Â  Â  Â  Â  Â  Â  successClass = 'message-success';
Â  Â  Â  Â  Â  Â  } 
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (actionName === "Eat") {
Â  Â  Â  Â  Â  Â  Â  Â  message += ` Hunger replenished. Current: ${gameState.hunger.toFixed(0)}%.`;
Â  Â  Â  Â  Â  Â  Â  Â  successClass = 'message-success';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (actionName === "Escape") {
Â  Â  Â  Â  Â  Â  Â  Â  if (gameState.activeThreats.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Escape removes the oldest threat (index 0)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const escapedThreat = gameState.activeThreats.shift();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.escapedBrainrots.push(escapedThreat.name);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message = `You successfully **ESCAPED** the encounter with **${escapedThreat.name}**! Health reduced by 10%.`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  successClass = 'message-hint';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message = `You tried to **ESCAPE**, but there was nothing to run from. Stamina drained.`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  appendLog(message, successClass);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Check if all AP is spent
Â  Â  Â  Â  Â  Â  if (gameState.actionPoints <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  appendLog("Action Points depleted. Advancing to the next night.", 'message-event');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(window.advanceNight, 1000); // Call through window object for safety
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  updateStatsDisplay();
Â  Â  Â  Â  Â  Â  checkAndApplyHint();
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- COMBAT FUNCTIONS ---
Â  Â  Â  Â  
Â  Â  Â  Â  function enterFightScreen(targetIndex) {
Â  Â  Â  Â  Â  Â  const targetThreat = gameState.activeThreats[targetIndex];
Â  Â  Â  Â  Â  Â  if (!targetThreat) return;

Â  Â  Â  Â  Â  Â  gameState.fightState.inProgress = true;
Â  Â  Â  Â  Â  Â  gameState.fightState.targetThreatIndex = targetIndex;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Set Player/Threat starting HP for THIS fight (Threat uses its calculated baseHP)
Â  Â  Â  Â  Â  Â  gameState.fightState.playerHP = 100;
Â  Â  Â  Â  Â  Â  gameState.fightState.threatHP = targetThreat.baseHP;

Â  Â  Â  Â  Â  Â  // Display setup
Â  Â  Â  Â  Â  Â  document.getElementById('fight-screen').style.display = 'flex';
Â  Â  Â  Â  Â  Â  document.getElementById('fight-threat-name').textContent = targetThreat.name.toUpperCase();
Â  Â  Â  Â  Â  Â  document.getElementById('fight-log').innerHTML = '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  fightLog(`You are engaging **${targetThreat.name}** with an estimated combat HP of **${targetThreat.baseHP.toFixed(0)}%**. Prepare to fight!`);
Â  Â  Â  Â  Â  Â  D.gameContainer.scrollTop = 0; // Scroll to top to ensure fight screen is visible

Â  Â  Â  Â  Â  Â  // Since Fight costs 0 AP, we only need to deduct 1 AP if the fight is NOT against the oldest threat (i.e. if we allowed target selection)
Â  Â  Â  Â  Â  Â  // But since we enforce targeting the oldest threat (index 0) for now, this remains 0 cost.

Â  Â  Â  Â  Â  Â  // The combat loop starts with the first move prompt
Â  Â  Â  Â  Â  Â  setTimeout(promptNextFightMove, 500);
Â  Â  Â  Â  }

Â  Â  Â  Â  function promptNextFightMove() {
Â  Â  Â  Â  Â  Â  if (!gameState.fightState.inProgress) return;

Â  Â  Â  Â  Â  Â  // V12.6 Change: Reduced Brainrot PUNCH chance from 40% to 25%
Â  Â  Â  Â  Â  Â  const threatAction = Math.random() < 0.25 ? 'PUNCH' : 'DODGE';
Â  Â  Â  Â  Â  Â  gameState.fightState.threatNextMove = threatAction;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  document.getElementById('fight-prompt').textContent = "What is your counter-action? (PUNCH or DODGE)";
Â  Â  Â  Â  Â  Â  // For now, Brainrot move is not revealed to the player immediately
Â  Â  Â  Â  }

Â  Â  Â  Â  function fightLog(message, className = '') {
Â  Â  Â  Â  Â  Â  const logDiv = document.getElementById('fight-log');
Â  Â  Â  Â  Â  Â  const p = document.createElement('p');
Â  Â  Â  Â  Â  Â  p.className = className;
Â  Â  Â  Â  Â  Â  p.innerHTML = message;
Â  Â  Â  Â  Â  Â  logDiv.appendChild(p);
Â  Â  Â  Â  Â  Â  logDiv.scrollTop = logDiv.scrollHeight;
Â  Â  Â  Â  }

Â  Â  Â  Â  window.fightAction = function(playerAction) {
Â  Â  Â  Â  Â  Â  if (!gameState.fightState.inProgress) return;

Â  Â  Â  Â  Â  Â  const targetThreat = gameState.activeThreats[gameState.fightState.targetThreatIndex];
Â  Â  Â  Â  Â  Â  if (!targetThreat) return; 

Â  Â  Â  Â  Â  Â  const threatAction = gameState.fightState.threatNextMove;
Â  Â  Â  Â  Â  Â  let playerDamage = 0;
Â  Â  Â  Â  Â  Â  let threatDamage = 0;

Â  Â  Â  Â  Â  Â  if (playerAction === 'PUNCH') {
Â  Â  Â  Â  Â  Â  Â  Â  if (threatAction === 'DODGE') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Punches a dodging target: Minor damage to threat
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  threatDamage = 15 + Math.random() * 5;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fightLog(`You punched the **${targetThreat.name}**! It dodged, but you landed a glancing blow. (-${threatDamage.toFixed(1)} HP)`, 'message-success');
Â  Â  Â  Â  Â  Â  Â  Â  } else { // threatAction === 'PUNCH'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Punches a punching target: Heavy damage to player
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerDamage = 20 + Math.random() * 10; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fightLog(`The **${targetThreat.name}** met your attack! Heavy blow taken! (-${playerDamage.toFixed(1)} HP)`, 'message-fail');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else { // playerAction === 'DODGE'
Â  Â  Â  Â  Â  Â  Â  Â  if (threatAction === 'PUNCH') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Dodges a punching target: No damage
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fightLog(`You successfully dodged the **${targetThreat.name}**'s heavy strike! (No damage taken)`, 'message-success');
Â  Â  Â  Â  Â  Â  Â  Â  } else { // threatAction === 'DODGE'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Dodges a dodging target: Minor self-fatigue
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playerDamage = 5; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fightLog(`You both danced around each other. Minor fatigue taken. (-${playerDamage.toFixed(1)} HP)`, 'message-fail');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Apply damage
Â  Â  Â  Â  Â  Â  gameState.fightState.playerHP -= playerDamage;
Â  Â  Â  Â  Â  Â  gameState.fightState.threatHP -= threatDamage;

Â  Â  Â  Â  Â  Â  // Update bars (Threat bar uses current HP relative to escalated baseHP for visual percentage)
Â  Â  Â  Â  Â  Â  document.getElementById('fight-player-fill').style.width = `${clamp(gameState.fightState.playerHP)}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('fight-player-hp').textContent = gameState.fightState.playerHP.toFixed(0);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Calculate percentage based on current HP vs. escalated baseHP
Â  Â  Â  Â  Â  Â  const currentThreatHPRatio = (gameState.fightState.threatHP / targetThreat.baseHP) * 100;
Â  Â  Â  Â  Â  Â  document.getElementById('fight-threat-fill').style.width = `${clamp(currentThreatHPRatio)}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('fight-threat-hp').textContent = clamp(currentThreatHPRatio).toFixed(0);

Â  Â  Â  Â  Â  Â  // Check for fight resolution
Â  Â  Â  Â  Â  Â  if (gameState.fightState.playerHP <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  // Player defeated in combat
Â  Â  Â  Â  Â  Â  Â  Â  fightLog(`You collapsed under the assault! The Brainrot consumes your attention.`, 'message-critical');
Â  Â  Â  Â  Â  Â  Â  Â  exitFightScreen(false);
Â  Â  Â  Â  Â  Â  } else if (gameState.fightState.threatHP <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  // Threat defeated
Â  Â  Â  Â  Â  Â  Â  Â  fightLog(`The **${targetThreat.name}** has been overwhelmed! Victory!`, 'message-success');
Â  Â  Â  Â  Â  Â  Â  Â  exitFightScreen(true);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Continue fight
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(promptNextFightMove, 1000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function exitFightScreen(victory) {
Â  Â  Â  Â  Â  Â  document.getElementById('fight-screen').style.display = 'none';
Â  Â  Â  Â  Â  Â  gameState.fightState.inProgress = false;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Apply residual player health damage to main health bar
Â  Â  Â  Â  Â  Â  const finalHealthPercentage = gameState.fightState.playerHP;
Â  Â  Â  Â  Â  Â  gameState.health = clamp(gameState.health * (finalHealthPercentage / 100));

Â  Â  Â  Â  Â  Â  const targetIndex = gameState.fightState.targetThreatIndex;
Â  Â  Â  Â  Â  Â  const dealtWithThreat = gameState.activeThreats[targetIndex];

Â  Â  Â  Â  Â  Â  if (victory) {
Â  Â  Â  Â  Â  Â  Â  Â  // 1. Remove the defeated threat from the active list
Â  Â  Â  Â  Â  Â  Â  Â  gameState.activeThreats.splice(targetIndex, 1);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // 2. Grant AP reward
Â  Â  Â  Â  Â  Â  Â  Â  gameState.actionPoints += FIGHT_AP_REWARD;
Â  Â  Â  Â  Â  Â  Â  Â  appendLog(`Combat victory! You defeated **${dealtWithThreat.name}** and gained **+${FIGHT_AP_REWARD} AP** to spend. Current AP: ${gameState.actionPoints}`, 'message-success');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Player lost the fight. The Brainrot is not defeated and remains active.
Â  Â  Â  Â  Â  Â  Â  Â  appendLog(`Combat loss. You retreated with significant injuries. The **${dealtWithThreat.name}** remains active and stronger.`, 'message-critical');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (gameState.health <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  endGame(false, "You were critically wounded in combat.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // If AP is depleted, advance night
Â  Â  Â  Â  Â  Â  if (gameState.actionPoints <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â appendLog("Action Points depleted. Advancing to the next night.", 'message-event');
Â  Â  Â  Â  Â  Â  Â  Â  Â setTimeout(window.advanceNight, 1000); // Call through window object for safety
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  updateStatsDisplay();
Â  Â  Â  Â  Â  Â  // Since the main action loop isn't bypassed, normal flow resumes
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- END GAME & UTILITY ---

Â  Â  Â  Â  function endGame(win, reason = "") {
Â  Â  Â  Â  Â  Â  gameState.isRunning = false;
Â  Â  Â  Â  Â  Â  let message;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (win && reason.includes("rescue helicopter")) {
Â  Â  Â  Â  Â  Â  Â  Â  message = `ðŸš RESCUE! You made it through 99 Nights! ${reason}`;
Â  Â  Â  Â  Â  Â  } else if (win) {
Â  Â  Â  Â  Â  Â  Â  Â  message = `VICTORY! You survived all ${NIGHTS_TO_SURVIVE} nights!`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  message = `DEFEAT! ${reason} You only survived ${gameState.night} nights.`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  alert(message);
Â  Â  Â  Â  Â  Â  appendLog(message, win ? 'message-success' : 'message-critical');
Â  Â  Â  Â  Â  Â  D.startButton.textContent = "RESTART GAME";
Â  Â  Â  Â  Â  Â  D.startButton.onclick = () => window.location.reload(); 
Â  Â  Â  Â  Â  Â  D.startButton.style.display = 'block';
Â  Â  Â  Â  Â  Â  D.actionButtonsDiv.style.display = 'none';
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- TUTORIAL FUNCTIONS ---

Â  Â  Â  Â  function startTutorial() {
Â  Â  Â  Â  Â  Â  D.pregameTutorial.style.display = 'flex';
Â  Â  Â  Â  Â  Â  gameState.tutorialStep = 1;
Â  Â  Â  Â  Â  Â  window.runTutorialStep(1); // Start at step 1
Â  Â  Â  Â  }

Â  Â  Â  Â  function skipTutorial() {
Â  Â  Â  Â  Â  Â  gameState.tutorialViewed = true;
Â  Â  Â  Â  Â  Â  D.pregameTutorial.style.display = 'none';
Â  Â  Â  Â  Â  Â  initializeGameUI();
Â  Â  Â  Â  }

Â  Â  Â  Â  window.runTutorialStep = function(step) { // Made global for onclick access
Â  Â  Â  Â  Â  Â  gameState.tutorialStep = step;
Â  Â  Â  Â  Â  Â  const stepText = document.getElementById('tutorial-step-text');
Â  Â  Â  Â  Â  Â  const actionsDiv = document.getElementById('tutorial-actions');
Â  Â  Â  Â  Â  Â  actionsDiv.innerHTML = '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  switch(gameState.tutorialStep) {
Â  Â  Â  Â  Â  Â  Â  Â  case 1:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stepText.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>1. Core Loop & AP</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>The game progresses night by night (99 total). Each night, you gain **3 Action Points (AP)**. All utility actions (Study, Eat, Maintain Gear, Escape) cost 1 AP.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>When AP reaches 0, the night ends, and status effects (Hunger, Gear Drain) are applied.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionsDiv.innerHTML = `<button onclick="runTutorialStep(2)">NEXT (Threats)</button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 2:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stepText.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>2. Brainrot Spawning & Stacking</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>A new Brainrot appears **every night**. Multiple Brainrots can be active simultaneously, stacking up pressure.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>The **Escape** (1 AP) and **Fight** (0 AP) actions always target the **oldest Brainrot** (the one that spawned first).</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionsDiv.innerHTML = `<button onclick="runTutorialStep(3)">NEXT (Escalation)</button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 3:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stepText.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>3. Escalation & Forced Combat</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>If the **oldest Brainrot** is not dealt with (Fought or Escaped):</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>Each day it persists, its combat health is multiplied by **1.5x**.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>If it persists for **3 nights**, combat is **FORCED** on the 4th night, overriding other actions.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionsDiv.innerHTML = `<button onclick="runTutorialStep(4)">NEXT (Combat & Rewards)</button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 4:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stepText.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>4. Combat and AP Reward</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Combat is a tactical mind-game of choosing PUNCH or DODGE against the Brainrot's hidden move.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>**If you DEFEAT a Brainrot**, you gain **+1 AP** to spend on other actions this turn.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>If you lose, you take massive damage, and the Brainrot persists.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionsDiv.innerHTML = `<button onclick="runTutorialStep(5)">NEXT (Utility Actions)</button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 5:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stepText.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>5. Key Utility Actions (1 AP each)</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>**Study:** Gains Knowledge. High Knowledge unlocks a **Hint Chance** before acting.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>**Eat:** Replenishes Hunger. Low Hunger drains Health.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>**Maintain Gear:** Repairs gear. Low Durability drains Health.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li>**Escape:** Costs 1 AP and 10 Health, but immediately removes the oldest Brainrot.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  actionsDiv.innerHTML = `<button onclick="runTutorialStep(6)">START GAME</button>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  case 6:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Final step, start the game
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.tutorialViewed = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  D.pregameTutorial.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // After tutorial, set tutorial step to 0 and initialize UI
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.tutorialStep = 0; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  initializeGameUI();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  skipTutorial();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // --- INITIALIZATION ---
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  initializeDOMElements(); 
Â  Â  Â  Â  Â  Â  // Wait for user to click START
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
